---
title: Amazon S3 缓存
description: 使用 Amazon S3 存储桶管理构建缓存
keywords: build, buildx, cache, backend, s3, buckets, aws
---

{{< summary-bar feature_name="Amazon S3 缓存" >}}

`s3` 缓存存储将您的构建缓存结果上传到 [Amazon S3 文件存储服务](https://aws.amazon.com/s3/) 或其他兼容 S3 的服务，如 [MinIO](https://min.io/)。

默认的 `docker` 驱动程序不支持此缓存存储后端。要使用此功能，请使用不同的驱动程序创建一个新构建器。有关更多信息，请参阅 [构建驱动程序](/manuals/build/builders/drivers/_index.md)。

## 概要

```console
$ docker buildx build --push -t <user>/<image> \
  --cache-to type=s3,region=<region>,bucket=<bucket>,name=<cache-image>[,parameters...] \
  --cache-from type=s3,region=<region>,bucket=<bucket>,name=<cache-image> .
```

下表描述了您可以传递给 `--cache-to` 和 `--cache-from` 的可用 CSV 参数。

| 名称 | 选项 | 类型 | 默认值 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| `region`             | `cache-to`,`cache-from` | 字符串      |         | 必填。地理位置。                                 |
| `bucket`             | `cache-to`,`cache-from` | 字符串      |         | 必填。S3 存储桶名称。                               |
| `name`               | `cache-to`,`cache-from` | 字符串      |         | 缓存镜像名称。                                       |
| `endpoint_url`       | `cache-to`,`cache-from` | 字符串      |         | S3 存储桶的端点。                                     |
| `blobs_prefix`       | `cache-to`,`cache-from` | 字符串      |         | 加在 blob 文件名前的前缀。                           |
| `upload_parallelism` | `cache-to`              | 整数     | `4`     | 并行层上传的数量。                              |
| `touch_refresh`      | `cache-to`              | 时间        | `24h`   | 更新未更改缓存层的时间戳的间隔。 |
| `manifests_prefix`   | `cache-to`,`cache-from` | 字符串      |         | 加在清单文件名前的前缀。                       |
| `use_path_style`     | `cache-to`,`cache-from` | 布尔值     | `false` | 为 `true` 时，在 URL 中使用 `bucket` 而不是主机名。     |
| `access_key_id`      | `cache-to`,`cache-from` | 字符串      |         | 请参阅 [身份验证][1]。                                       |
| `secret_access_key`  | `cache-to`,`cache-from` | 字符串      |         | 请参阅 [身份验证][1]。                                       |
| `session_token`      | `cache-to`,`cache-from` | 字符串      |         | 请参阅 [身份验证][1]。                                       |
| `mode`               | `cache-to`              | `min`,`max` | `min`   | 要导出的缓存层，请参阅 [缓存模式][2]。       |
| `ignore-error`       | `cache-to`              | 布尔值     | `false` | 忽略由于缓存导出失败引起的错误。                  |

[1]: #身份验证
[2]: _index.md#缓存模式

## 身份验证

Buildx 可以重用现有的 AWS 凭据（通过凭据文件或环境变量配置），用于向 S3 推送和拉取缓存。或者，您可以使用 `access_key_id`、`secret_access_key` 和 `session_token` 属性直接在 CLI 上指定凭据。

有关使用环境变量和凭据文件进行身份验证的详细信息，请参阅 [AWS Go SDK, 指定凭据][3]。

[3]: https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html#specifying-credentials

## 延伸阅读

有关缓存的简介，请参阅 [Docker 构建缓存](../_index.md)。

有关 `s3` 缓存后端的更多信息，请参阅 [BuildKit README](https://github.com/moby/buildkit#s3-cache-experimental)。
