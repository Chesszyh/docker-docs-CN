---
title: 基础镜像强化
linktitle: 强化
description: 了解 Docker 强化镜像如何为安全性设计，具有最小组件、非 root 执行和默认安全配置。
keywords: hardened base image, minimal container image, non-root containers, secure container configuration, remove package manager
---

## 什么是基础镜像强化？

基础镜像强化是通过最小化容器镜像基础层包含的内容并使用安全优先的默认配置来保护它们的过程。强化的基础镜像移除了不必要的组件，如 shell、编译器和包管理器，这限制了可用的攻击面，使攻击者更难在容器内获得控制或提升权限。

强化还包括应用最佳实践，如以非 root 用户运行、减少可写表面，以及通过不可变性确保一致性。

## 为什么它很重要？

大多数容器从其使用的基础镜像继承其安全态势。如果基础镜像包含不必要的工具或以提升的权限运行，那么在其上构建的每个容器都会暴露于这些风险。

强化基础镜像：

- 通过移除可能被利用的工具和库来减少攻击面
- 通过取消 root 访问并限制容器可以执行的操作来强制实施最小权限
- 通过避免运行时更改和漂移来提高可靠性和一致性
- 与安全软件供应链实践保持一致，并有助于满足合规标准

使用强化的基础镜像是保护您在容器中构建和运行的软件的关键第一步。

## 移除了什么以及为什么

强化镜像通常排除在安全生产环境中有风险或不必要的常见组件：

| 移除的组件 | 原因 |
|--------------------------------------------------|----------------------------------------------------------------------------------|
| Shell（例如 `sh`、`bash`） | 防止用户或攻击者在容器内执行任意命令 |
| 包管理器（例如 `apt`、`apk`） | 禁用构建后安装软件的能力，减少漂移和暴露 |
| 编译器和解释器 | 避免引入可用于运行或注入恶意代码的工具 |
| 调试工具（例如 `strace`、`curl`、`wget`） | 减少被利用或信息泄露的风险 |
| 未使用的库或语言环境 | 缩小镜像大小并最小化攻击向量 |

## Docker 强化镜像如何应用基础镜像强化

Docker 强化镜像（DHIs）在设计上应用基础镜像强化原则。每个镜像都被构建为仅包含其特定目的所需的内容，无论是构建应用程序（带有 `-dev` 或 `-sdk` 标签）还是在生产中运行它们。

### Docker 强化镜像特征

Docker 强化镜像被构建为：

- 精简：仅包含必要的库和二进制文件
- 不可变：镜像在构建时固定——没有运行时安装
- 默认非 root：容器以非特权用户运行，除非另有配置
- 目的范围化：不同的标签可用于开发（`-dev`）、基于 SDK 的构建（`-sdk`）和生产运行时

这些特性有助于在开发、测试和生产环境中强制执行一致、安全的行为。

### Docker 强化镜像兼容性注意事项

由于 Docker 强化镜像剥离了许多常见工具，它们可能无法开箱即用于所有用例。您可能需要：

- 使用多阶段构建在 `-dev` 镜像中编译代码或安装依赖项，并将输出复制到强化的运行时镜像中
- 用等效的入口点二进制文件替换 shell 脚本，或在需要时明确包含 shell
- 使用 [Docker Debug](../../../reference/cli/docker/debug.md) 临时检查或排除容器故障，而无需更改基础镜像

这些权衡是有意为之的，有助于支持构建安全、可重现和生产就绪的容器的最佳实践。
