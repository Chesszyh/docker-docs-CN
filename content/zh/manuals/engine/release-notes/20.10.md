---
title: Docker Engine 20.10 发布说明
linkTitle: Engine v20.10
description: 了解 Docker Engine 20.10 版的新功能、错误修复和重大变更
keywords: docker, docker engine, ce, whats new, release notes, 发布说明
toc_min: 1
toc_max: 2
---

本文件描述了 Docker Engine 20.10 版的最新变更、新增内容、已知问题和修复。

## 20.10.24
{{< release-date date="2023-04-04" >}}

### 更新

- 将 Go 运行时更新至 [1.19.7](https://go.dev/doc/devel/release#go1.19.minor)。
- 将 Docker Buildx 更新至 [v0.10.4](https://github.com/docker/buildx/releases/tag/v0.10.4)。
- 将 containerd 更新至 [v1.6.20](https://github.com/containerd/containerd/releases/tag/v1.6.20)。
- 将 runc 更新至 [v1.1.5](https://github.com/opencontainers/runc/releases/tag/v1.1.5)。

### 错误修复与改进

- 修复了许多可能导致 Swarm 加密 overlay 网络无法履行其保证的问题，解决了 [CVE-2023-28841](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-28841)、[CVE-2023-28840](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-28840) 和 [CVE-2023-28842](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-28842)。
  - 内核不支持加密 overlay 网络现在会报错。
  - 加密 overlay 网络会立即设置，而不是等待多个节点连接。
  - 加密 overlay 网络现在通过使用 `xt_bpf` 内核模块在 Red Hat Enterprise Linux 9 上可用。
  - Swarm overlay 网络的用户应查看 [GHSA-vwm3-crmr-xfxw](https://github.com/moby/moby/security/advisories/GHSA-vwm3-crmr-xfxw) 以确保没有发生非预期的暴露。
- 将 github.com/containerd/fifo 更新至 v1.1.0 以修复潜在的崩溃 (panic) [moby/moby#45216](https://github.com/moby/moby/pull/45242)。
- 修复了已安装 CLI 插件缺失 Bash 补全的问题 [docker/cli#4091](https://github.com/docker/cli/pull/4091)。


## 20.10.23
{{< release-date date="2023-01-19" >}}

此版本的 Docker Engine 包含了更新版本的 Docker Compose、Docker Buildx、containerd，以及一些细微的错误修复和改进。

### 更新

- 将 Docker Compose 更新至 [v2.15.1](https://github.com/docker/compose/releases/tag/v2.15.1)。
- 将 Docker Buildx 更新至 [v0.10.0](https://github.com/docker/buildx/releases/tag/v0.10.0)。
- 将 containerd (`containerd.io` 软件包) 更新至 [v1.6.15](https://github.com/containerd/containerd/releases/tag/v1.6.15)。
- 更新了 `docker-compose-cli` 的软件包版本格式，以允许发行版版本更新 [docker/docker-ce-packaging#822](https://github.com/docker/docker-ce-packaging/pull/822)。
- 将 Go 运行时更新至 [1.18.10](https://go.dev/doc/devel/release#go1.18.minor)。

### 错误修复与改进

- 修复了在启用 BuildKit 时使用 `--add-host=host.docker.internal:host-gateway` 会导致 `docker build` 失败的问题 [moby/moby#44650](https://github.com/moby/moby/pull/44650)。
- 还原 seccomp：在默认配置文件中屏蔽对 `AF_VSOCK` 的套接字调用 [moby/moby#44712](https://github.com/moby/moby/pull/44712)。

  这一变更虽然从安全角度来看是有利的，但导致了某些用例的行为发生了变化。因此，我们将其还原以确保受影响用户的稳定性和兼容性。

  然而，在容器中使用 `AF_VSOCK` 的用户应当意识到，这一 (特殊的) 地址族目前在任何版本的 Linux 内核中都没有被命名空间化，可能会导致意外行为，例如容器直接与主机的管理程序 (hypervisors) 通信。

  未来的版本将过滤 `AF_VSOCK`。需要允许容器通过未命名空间化的 `AF_VSOCK` 通信的用户将需要关闭 seccomp 限制或设置自定义的 seccomp 配置文件。

## 20.10.22
{{< release-date date="2022-12-16" >}}

此版本的 Docker Engine 包含了更新版本的 Docker Compose、Docker Scan、containerd，以及一些细微的错误修复和改进。

### 更新

- 将 Docker Compose 更新至 [v2.14.1](https://github.com/docker/compose/releases/tag/v2.14.1)。
- 将 Docker Scan 更新至 [v0.23.0](https://github.com/docker/scan-cli-plugin/releases/tag/v0.23.0)。
- 将 containerd (`containerd.io` 软件包) 更新至 [v1.6.13](https://github.com/containerd/containerd/releases/tag/v1.6.13)，包含了对 [CVE-2022-23471](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-23471) 的修复。
- 将 Go 运行时更新至 [1.18.9](https://go.dev/doc/devel/release#go1.18.minor)，包含了针对 [CVE-2022-41716](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41716)、[CVE-2022-41717](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41717) 和 [CVE-2022-41720](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41720) 的修复。

### 错误修复与改进

- 改进了尝试拉取不支持的镜像格式或 OCI 制品时的错误消息 [moby/moby#44413](https://github.com/moby/moby/pull/44413), [moby/moby#44569](https://github.com/moby/moby/pull/44569)。
- 修复了一个问题，即为容器选择随机端口时忽略了主机的临时端口范围 [moby/moby#44476](https://github.com/moby/moby/pull/44476)。
- 修复了在使用 OpenSSH 8.9 或更高版本的主机上执行 `docker build` 期间出现的 `ssh: parse error in message type 27` 错误 [moby/moby#3862](https://github.com/moby/moby/pull/3862)。
- seccomp：在默认配置文件中屏蔽对 `AF_VSOCK` 的套接字调用 [moby/moby#44564](https://github.com/moby/moby/pull/44564)。


## 20.10.21
{{< release-date date="2022-10-25" >}}

此版本的 Docker Engine 包含了更新版本的 Docker Compose、Docker Scan、containerd，增加了对 Ubuntu 22.10 的支持，以及一些细微的错误修复和改进。

### 新功能
- 提供针对 Ubuntu 22.10 (Kinetic Kudu) 的软件包。
- 增加了对 Docker Hub 的 `allow-nondistributable-artifacts` 支持 [moby/moby#44313](https://github.com/moby/moby/pull/44313)。

### 更新

- 将 Docker Compose 更新至 [v2.12.2](https://github.com/docker/compose/releases/tag/v2.12.2)。
- 将 Docker Scan 更新至 [v0.21.0](https://github.com/docker/scan-cli-plugin/releases/tag/v0.21.0)。
- 将 containerd (`containerd.io` 软件包) 更新至 [v1.6.9](https://github.com/containerd/containerd/releases/tag/v1.6.9)。
- 更新了捆绑的 BuildKit 版本，以修复 `output clipped, log limit 1MiB reached` 错误 [moby/moby#44339](https://github.com/moby/moby/pull/44339)。

### 错误修复与改进
- 移除了 bash 补全中 `--platform` 的实验性限制 [docker/cli#3824](https://github.com/docker/cli/pull/3824)。
- 修复了在 Windows 上使用旧版 CLI 将 Docker Engine 注册为服务时出现的 `Invalid standard handle identifier` 崩溃 (panic) [moby/moby#44326](https://github.com/moby/moby/pull/44326)。
- 修复了在 Windows 的 Cygwin 环境下运行 Git 命令的问题 [moby/moby#44332](https://github.com/moby/moby/pull/44332)。

## 20.10.20
{{< release-date date="2022-10-18" >}}

此版本的 Docker Engine 包含了对 Git 漏洞 ([CVE-2022-39253](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-39253)) 的部分缓解措施，并更新了对 `image:tag@digest` 镜像引用的处理。

该 Git 漏洞允许恶意构造的 Git 仓库在被用作构建上下文时，将任意文件系统路径复制到生成的容器/镜像中；这种情况可能发生在守护进程和 API 客户端中，具体取决于所使用的版本和工具。

此版本及守护进程 API 的其他使用者中提供的缓解措施是部分的，仅保护构建 Git URL 上下文 (例如 `git+protocol://`) 的用户。由于该漏洞仍可通过手动运行与子模块交互及检出的 Git 命令被利用，用户应立即升级到已打补丁的 Git 版本以防御此漏洞。更多详情可参阅 GitHub 博客 (["Git 安全漏洞公告"](https://github.blog/2022-10-18-git-security-vulnerabilities-announced/))。

### 更新

- 将 Docker Compose 更新至 [v2.12.0](https://github.com/docker/compose/releases/tag/v2.12.0)。
- 更新了对 `image:tag@digest` 引用的处理。当使用 `image:tag@digest` 拉取镜像 ("按摘要拉取") 时，镜像解析通过内容寻址摘要进行，不使用 `image` 和 `tag`。虽然这是预期的行为，但这可能会导致令人困惑的行为，并且可能会通过社会工程学被利用来运行本地镜像库中已存在的镜像。Docker 现在会检查摘要是否与用于拉取镜像的仓库名称匹配，否则将产生错误。
- 更新了对 `image:tag@digest` 引用的处理。详情请参阅上方的“守护进程”部分。

### 错误修复与改进

- 针对使用带有 Git URL 形式构建上下文的经典构建器的情况，增加了对 [CVE-2022-39253](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-39253) 的缓解措施。
- 为经典构建器增加了缓解措施，并将 BuildKit 更新至 [v0.8.3-31-gc0149372](https://github.com/moby/buildkit/commit/c014937225cba29cfb1d5161fd134316c0e9bdaa)，以应对 [CVE-2022-39253](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-39253)。

## 20.10.19
{{< release-date date="2022-10-14" >}}

此版本的 Docker Engine 修复了一些 bug，并更新了 Docker Compose 的版本。

### 更新

- 将 Docker Compose 更新至 [v2.11.2](https://github.com/docker/compose/releases/tag/v2.11.2)。
- 将 Go 运行时更新至 [1.18.7](https://go.dev/doc/devel/release#go1.18.minor)，包含了针对 [CVE-2022-2879](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-2879)、[CVE-2022-2880](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-2880) 和 [CVE-2022-41715](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41715) 的修复。

### 错误修复与改进

- 修复了在执行 `docker builder prune` 或 `docker system prune` 期间可能导致崩溃 (panic) 的问题 [moby/moby#44122](https://github.com/moby/moby/pull/44122)。
- 修复了一个 bug，即如果守护进程以“实时恢复”模式运行并重启，使用 `docker volume prune` 会移除仍在使用中的卷 [moby/moby#44238](https://github.com/moby/moby/pull/44238)。

## 20.10.18
{{< release-date date="2022-09-09" >}}

此版本的 Docker Engine 修复了一个低危安全问题，进行了一些细微的错误修复，并更新了 Docker Compose、Docker Buildx、`containerd` 和 `runc` 的版本。

### 更新

- 将 Docker Buildx 更新至 [v0.9.1](https://github.com/docker/buildx/releases/tag/v0.9.1)。
- 将 Docker Compose 更新至 [v2.10.2](https://github.com/docker/compose/releases/tag/v2.10.2)。
- 将 containerd (`containerd.io` 软件包) 更新至 [v1.6.8](https://github.com/containerd/containerd/releases/tag/v1.6.8)。
- 将 runc 版本更新至 [v1.1.4](https://github.com/opencontainers/runc/releases/tag/v1.1.4)。
- 将 Go 运行时更新至 [1.18.6](https://go.dev/doc/devel/release#go1.18.minor)，包含了针对 [CVE-2022-27664](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-27664) 和 [CVE-2022-32190](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-32190) 的修复。

### 错误修复与改进

- 增加了对 Docker Compose 的 Bash 补全支持 [docker/cli#3752](https://github.com/docker/cli/pull/3752)。
- 修复了构建期间文件能力 (file-capabilities) 未被保留的问题 [moby/moby#43876](https://github.com/moby/moby/pull/43876)。
- 修复了由于并发读取和写入 map 导致的崩溃 (panic) 问题 [moby/moby#44067](https://github.com/moby/moby/pull/44067)。
- 修复了与从属组权限相关的安全漏洞，该漏洞可能允许容器进程绕过容器内的主要组限制 [CVE-2022-36109](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-36109), [GHSA-rc4r-wh2q-q6c4](https://github.com/moby/moby/security/advisories/GHSA-rc4r-wh2q-q6c4)。
- seccomp：在默认策略中增加了对 Landlock 系统调用的支持 [moby/moby#43991](https://github.com/moby/moby/pull/43991)。
- seccomp：更新了默认策略，支持内核 5.12 - 5.16 中引入的新系统调用 [moby/moby#43991](https://github.com/moby/moby/pull/43991)。
- 修复了镜像清单缓存查找失败的问题，该失败会导致与镜像注册表的冗余往返 [moby/moby#44109](https://github.com/moby/moby/pull/44109)。
- 修复了 `exec` 进程和健康检查在超时时未被终止的问题 [moby/moby#44018](https://github.com/moby/moby/pull/44018)。

## 20.10.17
{{< release-date date="2022-06-06" >}}

此版本的 Docker Engine 更新了 Docker Compose 以及 `containerd` 和 `runc` 组件的版本，并包含了一些细微的错误修复。

### 更新

- 将 Docker Compose 更新至 [v2.6.0](https://github.com/docker/compose/releases/tag/v2.6.0)。
- 将 containerd (`containerd.io` 软件包) 更新至 [v1.6.6](https://github.com/containerd/containerd/releases/tag/v1.6.6)，包含了对 [CVE-2022-31030](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-31030) 的修复。
- 将 runc 版本更新至 [v1.1.2](https://github.com/opencontainers/runc/releases/tag/v1.1.2)，包含了对 [CVE-2022-29162](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29162) 的修复。
- 将 Go 运行时更新至 [1.17.11](https://go.dev/doc/devel/release#go1.17.minor)，包含了针对 [CVE-2022-30634](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-30634)、[CVE-2022-30629](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-30629)、[CVE-2022-30580](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-30580) 和 [CVE-2022-29804](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29804) 的修复。

### 错误修复与改进

- 从 zsh 补全脚本中移除了 docker 命令前的星号 [docker/cli#3648](https://github.com/docker/cli/pull/3648)。
- 修复了 Windows 上 overlay 模式下的主机端口冲突问题 [moby/moby#43644](https://github.com/moby/moby/pull/43644)。
- 确保性能调优始终应用于 libnetwork 沙箱 [moby/moby#43683](https://github.com/moby/moby/pull/43683)。

## 20.10.16
{{< release-date date="2022-05-12" >}}

此版本的 Docker Engine 修复了 macOS 版 Docker CLI 构建的一个回归问题，修复了使用 containerd 1.5 及以上版本时 `docker stats` 的一个问题，并更新了 Go 运行时以包含对 [CVE-2022-29526](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29526) 的修复。

### 更新
- 更新了 golang.org/x/sys 依赖，包含了针对 [CVE-2022-29526](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29526) 的修复。
- 更新了 `golang.org/x/sys` 构建时依赖，包含了针对 [CVE-2022-29526](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29526) 的修复。
- 将 Go 运行时更新至 [1.17.10](https://go.dev/doc/devel/release#go1.17.minor)，包含了针对 [CVE-2022-29526](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29526) 的修复。

### 错误修复与改进
- 修复了 [20.10.15](#201015) 中引入的 macOS 二进制文件的回归问题，该问题曾导致崩溃 (panic) [docker/cli#43426](https://github.com/docker/cli/pull/3592)。
- 修复了在 containerd 1.5.0 及以上版本运行时，`docker stats` 显示为空统计信息的问题 [moby/moby#43567](https://github.com/moby/moby/pull/43567)。
- 为 `docker scan` CLI 插件使用“弱 (weak)”依赖，以防止用户从下载的 RPM 包进行离线安装时出现“冲突请求”错误 [docker/docker-ce-packaging#659](https://github.com/docker/docker-ce-packaging/pull/659)。

## 20.10.15
{{< release-date date="2022-05-05" >}}

此版本的 Docker Engine 更新了 `compose`、`buildx`、`containerd` 和 `runc` 组件的版本，并包含了一些细微的错误修复。

### 更新
- 将 Docker Compose 更新至 [v2.5.0](https://github.com/docker/compose/releases/tag/v2.5.0)。
- 将 Docker Buildx 更新至 [v0.8.2](https://github.com/docker/buildx/releases/tag/v0.8.2)。
- 将 Go 运行时更新至 [1.17.9](https://go.dev/doc/devel/release#go1.17.minor)。
- 将 containerd (`containerd.io` 软件包) 更新至 [v1.6.4](https://github.com/containerd/containerd/releases/tag/v1.6.4)。
- 将 runc 版本更新至 [v1.1.1](https://github.com/opencontainers/runc/releases/tag/v1.1.1)。

### 错误修复与改进
- 为 stateCounter 使用 RWMutex，以防止潜在的锁定拥塞 [moby/moby#43426](https://github.com/moby/moby/pull/43426)。
- 防止守护进程在某些条件下无法找到可用 IP 范围的问题 [moby/moby#43360](https://github.com/moby/moby/pull/43360) 
- 增加了针对 CentOS 9 Stream 和 Fedora 36 的软件包。

### 已知问题
- 我们已在 20.10.15 版本中识别出 [macOS CLI 二进制文件](https://download.docker.com/mac/static/stable/) 的一个问题。此问题已在 [20.10.16](#201016) 版本中得到解决。

## 20.10.14
{{< release-date date="2022-03-23" >}}

此版本的 Docker Engine 更新了容器的默认可继承能力 (capabilities)，以解决 [CVE-2022-24769](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24769) 问题，同时也包含了一个新版本的 `containerd.io` 运行时来解决该问题。

### 更新
- 更新了默认的可继承能力。
- 更新了构建期间使用的容器的默认可继承能力。
- 将 containerd (`containerd.io` 软件包) 更新至 [v1.5.11](https://github.com/containerd/containerd/releases/tag/v1.5.11)。
- 将 `docker buildx` 更新至 [v0.8.1](https://github.com/docker/buildx/releases/tag/v0.8.1)。

## 20.10.13
{{< release-date date="2022-03-10" >}} 

此版本的 Docker Engine 包含了一些错误修复和打包变更，更新了 `docker scan` 和 `docker buildx` 命令，更新了 Go 运行时版本，并提供了新版本的 `containerd.io` 运行时。
随此版本一同，我们现在也提供 Docker Compose V2 的 `.deb` 和 `.rpm` 软件包，可以通过 (可选的) `docker-compose-plugin` 软件包进行安装。

### 新功能
- 提供针对 Docker Compose V2 的 `.deb` 和 `.rpm` 软件包。[Docker Compose v2.3.3](https://github.com/docker/compose/releases/tag/v2.3.3) 现在可以通过 `docker-compose-plugin` 软件包安装在 Linux 上，该插件为 Docker CLI 提供了 `docker compose` 子命令。Docker Compose 插件也可以独立安装和运行，作为 `docker-compose` (Docker Compose V1) 的直接替代品 [docker/docker-ce-packaging#638](https://github.com/docker/docker-ce-packaging/pull/638)。`compose-cli-plugin` 软件包也可用于支持 CLI 插件的旧版 Docker CLI (Docker CLI 18.09 及以上版本)。
- 为即将发布的 Ubuntu 22.04 "Jammy Jellyfish" LTS 版本提供软件包 [docker/docker-ce-packaging#645](https://github.com/docker/docker-ce-packaging/pull/645), [docker/containerd-packaging#271](https://github.com/docker/containerd-packaging/pull/271)。

### 更新
- 将捆绑的 buildx 版本更新至 [v0.8.0](https://github.com/docker/buildx/releases/tag/v0.8.0)。
- 将 `docker buildx` 更新至 [v0.8.0](https://github.com/docker/buildx/releases/tag/v0.8.0)。
- 将 `docker scan` (`docker-scan-plugin`) 更新至 [v0.17.0](https://github.com/docker/scan-cli-plugin/releases/tag/v0.17.0)。
- 将 containerd (`containerd.io` 软件包) 更新至 [v1.5.10](https://github.com/containerd/containerd/releases/tag/v1.5.10)。
- 将捆绑的 runc 版本更新至 [v1.0.3](https://github.com/opencontainers/runc/releases/tag/v1.0.3)。
- 将 Golang 运行时更新至 Go 1.16.15。
- 更新了 fluentd 日志驱动程序，以防止潜在的守护进程崩溃，并防止在使用 `fluentd-async-connect=true` 且远程服务器不可达时容器挂起 [moby/moby#43147](https://github.com/moby/moby/pull/43147)。

### 错误修复与改进
- 修复了更新容器状态时的竞态条件 [moby/moby#43166](https://github.com/moby/moby/pull/43166)。
- 更新了 etcd 依赖，以防止守护进程错误地持有文件锁 [moby/moby#43259](https://github.com/moby/moby/pull/43259)
- 修复了配置默认 `net.ipv4.ping_group_range` sysctl 时对用户命名空间的检测 [moby/moby#43084](https://github.com/moby/moby/pull/43084)。
- 如果镜像拉取期间发生连接失败，重试下载镜像清单 [moby/moby#43333](https://github.com/moby/moby/pull/43333)。
- 修复了命令行参考和 API 文档中的多处问题。
- 修复了在对产生大量日志消息的容器使用 "local" 日志驱动程序时可能出现的 OOM 问题 [moby/moby#43165](https://github.com/moby/moby/pull/43165)。

## 20.10.12
2021-12-13

此版本的 Docker Engine 仅包含打包方面的变更，并提供了 `docker scan` 和 `docker buildx` 命令的更新。v0.11.0 之前的 `docker scan` 版本无法检测到 [Log4j 2 CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)。我们在该版本中发布了更新版本的 `docker scan`，以帮助您扫描镜像中的此漏洞。

> [!NOTE]
>
> Linux 上的 `docker scan` 命令目前仅支持 x86 平台。我们尚未为 Linux 上的其他硬件架构提供软件包。

`docker scan` 功能作为一个单独的软件包提供，根据您的升级或安装方法，'docker scan' 可能不会自动更新到最新版本。请使用以下说明将 `docker scan` 更新至最新版本。您也可以使用这些说明来安装或升级 `docker scan` 软件包，而无需升级 Docker Engine：

在基于 `.deb` 的发行版上，如 Ubuntu 和 Debian：

```console
$ apt-get update && apt-get install docker-scan-plugin
```

在基于 RPM 的发行版上，如 CentOS 或 Fedora：

```console
$ yum install docker-scan-plugin
```

升级后，验证您是否安装了最新版本的 `docker scan`：

```console
$ docker scan --accept-license --version
Version:    v0.12.0
Git commit: 1074dd0
Provider:   Snyk (1.790.0 (standalone))
```

[阅读关于 CVE-2021-44228 的博文](https://www.docker.com/blog/apache-log4j-2-cve-2021-44228/)，了解如何使用 `docker scan` 命令检查镜像是否易受攻击。

### 打包

- 将 `docker scan` 更新至 [v0.12.0](https://github.com/docker/scan-cli-plugin/releases/tag/v0.12.0)。
- 将 `docker buildx` 更新至 [v0.7.1](https://github.com/docker/buildx/releases/tag/v0.7.1)。
- 将 Golang 运行时更新至 Go 1.16.12。


## 20.10.11
2021-11-17

> [!IMPORTANT]
>
> 由于 [Go 1.16](https://golang.org/doc/go1.16#net/http) 中 [net/http 的变更](https://github.com/golang/go/issues/40909)，通过 `$HTTP_PROXY` 环境变量配置的 HTTP 代理不再用于 TLS (`https://`) 连接。请确保您还设置了 `$HTTPS_PROXY` 环境变量以处理对 `https://` URL 的请求。参考 [配置守护进程使用代理](/manuals/engine/daemon/proxy.md) 了解如何为 Docker 守护进程配置代理服务器。


### 分发 (Distribution)

- 处理了模糊的 OCI 清单解析，以缓解 [CVE-2021-41190](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41190) / [GHSA-mc8v-mgrf-8f4m](https://github.com/opencontainers/distribution-spec/security/advisories/GHSA-mc8v-mgrf-8f4m)。详情请参阅 [GHSA-xmmx-7jpf-fx42](https://github.com/moby/moby/security/advisories/GHSA-xmmx-7jpf-fx42)。

### Windows

- 修复了 panic.log 文件被设置了只读属性的问题 [moby/moby#42987](https://github.com/moby/moby/pull/42987)。

### 打包

- 将 containerd 更新至 [v1.4.12](https://github.com/containerd/containerd/releases/tag/v1.4.12) 以缓解 [CVE-2021-41190](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41190)。
- 将 Golang 运行时更新至 Go 1.16.10。


## 20.10.10
2021-10-25

> [!IMPORTANT]
>
> 由于 [Go 1.16](https://golang.org/doc/go1.16#net/http) 中 [net/http 的变更](https://github.com/golang/go/issues/40909)，通过 `$HTTP_PROXY` 环境变量配置的 HTTP 代理不再用于 TLS (`https://`) 连接。请确保您还设置了 `$HTTPS_PROXY` 环境变量以处理对 `https://` URL 的请求。参考 [HTTP/HTTPS 代理部分](/manuals/engine/daemon/proxy.md) 了解如何为 Docker 守护进程配置代理服务器。


### 构建器 (Builder)

- 修复了平台匹配逻辑，以解决在 Arm 机器上启用 BuildKit 时 `docker build` 无法在本地镜像缓存中找到镜像的问题 [moby/moby#42954](https://github.com/moby/moby/pull/42954)。

### 运行时 (Runtime)

- 在默认 seccomp 策略中增加了对 `clone3` 系统调用的支持，以支持运行基于近期版本 Fedora 和 Ubuntu 的容器。[moby/moby/#42836](https://github.com/moby/moby/pull/42836)。
- Windows：更新了 hcsshim 库，修复了容器层中稀疏文件处理的一个 bug，该 bug 是由 Windows 近期的更改暴露出来的 [moby/moby#42944](https://github.com/moby/moby/pull/42944)。
- 修复了在某些情况下 `docker stop` 可能会永远挂起的问题 [moby/moby#42956](https://github.com/moby/moby/pull/42956)。

### Swarm

- 修复了更新服务在失败时不会回滚的问题 [moby/moby#42875](https://github.com/moby/moby/pull/42875)。

### 打包

- 增加了针对 Ubuntu 21.10 "Impish Indri" 和 Fedora 35 的软件包。
- 将 `docker scan` 更新至 v0.9.0
- 将 Golang 运行时更新至 Go 1.16.9。

## 20.10.9
2021-10-04

此版本是一个安全版本，包含 CLI、运行时的安全修复，以及 containerd.io 软件包的更新版本。

> [!IMPORTANT]
>
> 由于 [Go 1.16](https://golang.org/doc/go1.16#net/http) 中 [net/http 的变更](https://github.com/golang/go/issues/40909)，通过 `$HTTP_PROXY` 环境变量配置的 HTTP 代理不再用于 TLS (`https://`) 连接。请确保您还设置了 `$HTTPS_PROXY` 环境变量以处理对 `https://` URL 的请求。参考 [HTTP/HTTPS 代理部分](/manuals/engine/daemon/proxy.md) 了解如何为 Docker 守护进程配置代理服务器。

### 客户端

- [CVE-2021-41092](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41092)
  确保默认身份验证配置设置了地址字段，以防止凭据被发送到默认注册表。

### 运行时

- [CVE-2021-41089](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41089)
  在 `docker cp` 期间在 chroot 内创建父目录，以防止精心构造的容器更改主机文件系统中的现有文件权限。
- [CVE-2021-41091](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41091)
  锁定文件权限，以防止非特权用户发现并执行 `/var/lib/docker` 中的程序。

### 打包

> **已知问题**
>
> 此版本静态包中附带的 `ctr` 二进制文件不是静态链接的，无法在以 alpine 为基础镜像的 Docker 镜像中运行。用户可以安装 `libc6-compat` 软件包，或者下载之前版本的 `ctr` 二进制文件作为变通方法。详情请参阅与此问题相关的 containerd 工单：[containerd/containerd#5824](https://github.com/containerd/containerd/issues/5824)。

- 将 Golang 运行时更新至 Go 1.16.8，包含了针对 [CVE-2021-36221](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-36221) 和 [CVE-2021-39293](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-39293) 的修复。
- 将静态二进制文件以及 containerd.io rpm 和 deb 软件包更新至 containerd v1.4.11 和 runc v1.0.2，以解决 [CVE-2021-41103](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41103) 问题。
- 将 rpm 和 deb 软件包捆绑的 buildx 版本更新至 v0.6.3。

## 20.10.8
2021-08-03

> [!IMPORTANT]
>
> 由于 [Go 1.16](https://golang.org/doc/go1.16#net/http) 中 [net/http 的变更](https://github.com/golang/go/issues/40909)，通过 `$HTTP_PROXY` 环境变量配置的 HTTP 代理不再用于 TLS (`https://`) 连接。请确保您还设置了 `$HTTPS_PROXY` 环境变量以处理对 `https://` URL 的请求。参考 [HTTP/HTTPS 代理部分](/manuals/engine/daemon/proxy.md) 了解如何为 Docker 守护进程配置代理服务器。

### 弃用

- 弃用对加密 TLS 私钥的支持。RFC 1423 中指定的传统 PEM 加密在设计上是不安全的。因为它不对密文进行身份验证，所以容易受到填充提示攻击 (padding oracle attacks)，这可能让攻击者恢复明文。对加密 TLS 私钥的支持现已标记为弃用，并将在未来的版本中移除。[docker/cli#3219](https://github.com/docker/cli/pull/3219)
- 弃用 Kubernetes stack 支持。继 [Compose on Kubernetes](https://github.com/docker/compose-on-kubernetes) 弃用之后，Docker CLI 中 `stack` 和 `context` 命令对 Kubernetes 的支持现已标记为弃用，并将在未来的版本中移除 [docker/cli#3174](https://github.com/docker/cli/pull/3174)。

### 客户端

- 修复了 Windows 上的 `Invalid standard handle identifier` 错误 [docker/cli#3132](https://github.com/docker/cli/pull/3132)。

### 无根模式 (Rootless)

- 避免在启用 SELinux 的主机上出现 `can't open lock file /run/xtables.lock: Permission denied` 错误 [moby/moby#42462](https://github.com/moby/moby/pull/42462)。
- 在运行 SELinux 时禁用 overlay2，以防止权限被拒绝错误 [moby/moby#42462](https://github.com/moby/moby/pull/42462)。
- 修复了 openSUSE Tumbleweed 上的 `x509: certificate signed by unknown authority` 错误 [moby/moby#42462](https://github.com/moby/moby/pull/42462)。

### 运行时

- 在使用 `--platform` 选项拉取与指定架构不匹配的单架构镜像时打印警告 [moby/moby#42633](https://github.com/moby/moby/pull/42633)。
- 修复了在使用 cgroups v2 运行时出现的错误的 `Your kernel does not support swap memory limit` 警告 [moby/moby#42479](https://github.com/moby/moby/pull/42479)。
- Windows：修复了当 `HcsShutdownComputeSystem` 返回 `ERROR_PROC_NOT_FOUND` 错误时容器未停止的情况 [moby/moby#42613](https://github.com/moby/moby/pull/42613) 

### Swarm

- 修复了由于节点未能清理其旧的负载均衡器 IP 而可能存在重复 IP 地址的情况 [moby/moby#42538](https://github.com/moby/moby/pull/42538)
- 修复了日志代理 (log broker) 中的死锁问题 ("dispatcher is stopped") [moby/moby#42537](https://github.com/moby/moby/pull/42537)

### 打包

> **已知问题**
>
> 此版本静态包中附带的 `ctr` 二进制文件不是静态链接的，无法在以 alpine 为基础镜像的 Docker 镜像中运行。用户可以安装 `libc6-compat` 软件包，或者下载之前版本的 `ctr` 二进制文件作为变通方法。详情请参阅与此问题相关的 containerd 工单：[containerd/containerd#5824](https://github.com/containerd/containerd/issues/5824)。

- 移除了针对 Ubuntu 16.04 "Xenial" 和 Fedora 32 的打包，因为它们已达到 EOL [docker/docker-ce-packaging#560](https://github.com/docker/docker-ce-packaging/pull/560)
- 将 Golang 运行时更新至 Go 1.16.6
- 将 rpm 和 deb 软件包捆绑的 buildx 版本更新至 v0.6.1 [docker/docker-ce-packaging#562](https://github.com/docker/docker-ce-packaging/pull/562)
- 将静态二进制文件以及 containerd.io rpm 和 deb 软件包更新至 containerd v1.4.9 和 runc v1.0.1：[docker/containerd-packaging#241](https://github.com/docker/containerd-packaging/pull/241), [docker/containerd-packaging#245](https://github.com/docker/containerd-packaging/pull/245), [docker/containerd-packaging#247](https://github.com/docker/containerd-packaging/pull/247)。

## 20.10.7
2021-06-02

### 客户端

* 抑制了针对已弃用 cgroups 的警告 [docker/cli#3099](https://github.com/docker/cli/pull/3099)。
* 防止向 Linux 和 macOS 上的容器发送 `SIGURG` 信号。Go 运行时 (从 Go 1.14 开始) 内部使用 `SIGURG` 信号作为中断以支持可抢占的系统调用。在 Docker CLI 附加到容器的情况下，这些中断会被转发给容器。此修复将 Docker CLI 更改为忽略 `SIGURG` 信号 [docker/cli#3107](https://github.com/docker/cli/pull/3107), [moby/moby#42421](https://github.com/moby/moby/pull/42421)。

### 构建器 (Builder)

* 将 BuildKit 更新至版本 v0.8.3-3-g244e8cde [moby/moby#42448](https://github.com/moby/moby/pull/42448)：
    * 转换执行器中 exec 挂载的相对挂载点，以解决 runc v1.0.0-rc94 及以上版本中的破坏性变更。[moby/buildkit#2137](https://github.com/moby/buildkit/pull/2137)。
    * 增加了镜像推送遇到 5xx 错误时的重试机制。[moby/buildkit#2043](https://github.com/moby/buildkit/pull/2043)。
    * 修复了在使用带有通配符的 `COPY` 命令复制文件时，重命名文件不会使构建缓存失效的问题。注意此更改会使现有的使用通配符的复制命令构建缓存失效。[moby/buildkit#2018](https://github.com/moby/buildkit/pull/2018)。
    * 修复了使用挂载时构建缓存不失效的问题 [moby/buildkit#2076](https://github.com/moby/buildkit/pull/2076)。
* 修复了在使用旧版 schema 1 镜像且 `FROM` 镜像未被缓存时的构建失败问题 [moby/moby#42382](https://github.com/moby/moby/pull/42382)。

### 日志 (Logging)

* 更新了 hcsshim SDK，使 Windows 上的守护进程日志不那么冗长 [moby/moby#42292](https://github.com/moby/moby/pull/42292)。

### 无根模式 (Rootless)

* 修复了在启用了用户命名空间的守护进程上构建镜像时，能力 (capabilities) 未被尊重的问题 [moby/moby#42352](https://github.com/moby/moby/pull/42352)。

### 联网

* 更新了 libnetwork，修复了在内核启动参数为 `ipv6.disable=1` 的环境下发布端口的问题，并修复了导致内部 DNS 查找失败的死锁问题 [moby/moby#42413](https://github.com/moby/moby/pull/42413)。

### 贡献 (Contrib)

* 将 rootlesskit 更新至 v0.14.2，以修复使用 `slirp4netns` 端口驱动程序启动用户空间代理时的超时问题 [moby/moby#42294](https://github.com/moby/moby/pull/42294)。
* 修复了在无根守护进程上运行 docker-in-docker 时出现的 "Device or resource busy" 错误 [moby/moby#42342](https://github.com/moby/moby/pull/42342)。

### 打包

* 将 containerd 更新至 v1.4.6，将 runc 更新至 v1.0.0-rc95 以解决 [CVE-2021-30465](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30465) 问题 [moby/moby#42398](https://github.com/moby/moby/pull/42398), [moby/moby#42395](https://github.com/moby/moby/pull/42395), [docker/containerd-packaging#234](https://github.com/docker/containerd-packaging/pull/234)
* 将 containerd 更新至 v1.4.5，将 runc 更新至 v1.0.0-rc94 [moby/moby#42372](https://github.com/moby/moby/pull/42372), [moby/moby#42388](https://github.com/moby/moby/pull/42388), [docker/containerd-packaging#232](https://github.com/docker/containerd-packaging/pull/232)。
* 将 Docker Scan 插件软件包 (`docker-scan-plugin`) 更新至 v0.8 [docker/docker-ce-packaging#545](https://github.com/docker/docker-ce-packaging/pull/545)。


## 20.10.6
2021-04-12

### 客户端

* Docker CLI 支持 Apple Silicon (darwin/arm64) [docker/cli#3042](https://github.com/docker/cli/pull/3042)
* 配置：当回退到 v1.7.0 之前的配置文件 `~/.dockercfg` 时打印弃用警告。对该文件的支持将在未来的版本中移除 [docker/cli#3000](https://github.com/docker/cli/pull/3000)

### 构建器 (Builder)

* 修复了经典构建器静默忽略不支持的 Dockerfile 选项的问题，并改为提示启用 BuildKit [moby/moby#42197](https://github.com/moby/moby/pull/42197)

### 日志 (Logging)

* json-file：修复了偶尔出现的非预期 EOF 错误 [moby/moby#42174](https://github.com/moby/moby/pull/42174)

### 联网

* 修复了 docker 20.10 中的一个回归问题，该问题导致映射端口时默认不再绑定 IPv6 地址 [moby/moby#42205](https://github.com/moby/moby/pull/42205)
* 修复了隐式 IPv6 端口映射未包含在 API 响应中的问题。在 docker 20.10 之前，已发布端口默认可以通过 IPv4 和 IPv6 访问，但 API 仅包含有关 IPv4 (0.0.0.0) 映射的信息 [moby/moby#42205](https://github.com/moby/moby/pull/42205)
* 修复了 docker 20.10 中的一个回归问题，该问题导致 docker-proxy 在某些情况下未被终止 [moby/moby#42205](https://github.com/moby/moby/pull/42205)
* 修复了容器移除后 iptables 转发规则未被清理的问题 [moby/moby#42205](https://github.com/moby/moby/pull/42205)

### 打包

* 将静态二进制文件的 containerd 更新至 [v1.4.4](https://github.com/containerd/containerd/releases/tag/v1.4.4)。apt/yum 仓库上的 containerd.io 软件包已经完成了此项更新。包含了对 [CVE-2021-21334](https://github.com/containerd/containerd/security/advisories/GHSA-6g2q-w5j3-fwh4) 的修复。[moby/moby#42124](https://github.com/moby/moby/pull/42124)
* 增加了针对 Debian/Raspbian 11 Bullseye、Ubuntu 21.04 Hirsute Hippo 和 Fedora 34 的软件包 [docker/docker-ce-packaging#521](https://github.com/docker/docker-ce-packaging/pull/521) [docker/docker-ce-packaging#522](https://github.com/docker/docker-ce-packaging/pull/522) [docker/docker-ce-packaging#533](https://github.com/docker/docker-ce-packaging/pull/533)
* 在 Linux amd64 上通过 `docker-scan-plugin` 软件包提供 [Docker Scan CLI](https://github.com/docker/scan-cli-plugin) 插件，作为 `docker-ce-cli` 软件包的推荐依赖项 [docker/docker-ce-packaging#537](https://github.com/docker/docker-ce-packaging/pull/537)
* 包含了适用于 arm64 的 VPNKit 二进制文件 [moby/moby#42141](https://github.com/moby/moby/pull/42141)

### 插件

* 修复了 `docker plugin create` 创建的插件与旧版本 Docker 不兼容的问题 [moby/moby#42256](https://github.com/moby/moby/pull/42256)

### 无根模式 (Rootless)

* 将 RootlessKit 更新至 [v0.14.1](https://github.com/rootless-containers/rootlesskit/releases/tag/v0.14.1) (另见 [v0.14.0](https://github.com/rootless-containers/rootlesskit/releases/tag/v0.14.0) [v0.13.2](https://github.com/rootless-containers/rootlesskit/releases/tag/v0.13.2)) [moby/moby#42186](https://github.com/moby/moby/pull/42186) [moby/moby#42232](https://github.com/moby/moby/pull/42232)
* dockerd-rootless-setuptool.sh：创建 CLI 上下文 "rootless" [moby/moby#42109](https://github.com/moby/moby/pull/42109)
* dockerd-rootless.sh：禁止以 root 身份运行 [moby/moby#42072](https://github.com/moby/moby/pull/42072)
* 修复了绑定挂载现有挂载点时出现的 "operation not permitted" 错误 [moby/moby#42233](https://github.com/moby/moby/pull/42233)
* overlay2：修复了 "createDirWithOverlayOpaque(...) ... input/output error" [moby/moby#42235](https://github.com/moby/moby/pull/42235)
* overlay2：支持 "userxattr" 选项 (内核 5.11) [moby/moby#42168](https://github.com/moby/moby/pull/42168)
* btrfs：允许非特权用户删除子卷 (内核 >= 4.18) [moby/moby#42253](https://github.com/moby/moby/pull/42253)
* cgroup2：将 cgroup v2 移出实验性阶段 [moby/moby#42263](https://github.com/moby/moby/pull/42263)


## 20.10.5
2021-03-02

### 客户端

* 还原了 [docker/cli#2960](https://github.com/docker/cli/pull/2960)，以修复 `docker start --attach` 中的挂起问题，并移除了多余的 `Unsupported signal: <nil>. Discarding` 消息。[docker/cli#2987](https://github.com/docker/cli/pull/2987)。

## 20.10.4
2021-02-26

### 构建器 (Builder)

* 修复了内联缓存导入空层时错误的缓存匹配问题 [moby/moby#42061](https://github.com/moby/moby/pull/42061)
* 将 BuildKit 更新至 v0.8.2 [moby/moby#42061](https://github.com/moby/moby/pull/42061)
  * 解析器：避免令牌获取时的错误缓存
  * fileop：修复了包含输入索引的校验和，防止某些缓存未命中
  * 修复了带有挂载引用的类型错误的引用计数问题 (修复了 `invalid mutable ref` 错误)
  * git：仅为主要远程访问设置令牌，允许使用不同凭据克隆子模块
* 确保拉取后在 /var/lib/docker/buildkit/content/blobs/sha256 中删除 blobs。要清理旧状态，请运行 `builder prune` [moby/moby#42065](https://github.com/moby/moby/pull/42065)
* 修复了并行拉取同步的回归问题 [moby/moby#42049](https://github.com/moby/moby/pull/42049)
* 确保 libnetwork 状态文件不泄漏 [moby/moby#41972](https://github.com/moby/moby/pull/41972)

### 客户端

* 修复了如果没有配置文件时 `docker login` 发生的崩溃 (panic) [docker/cli#2959](https://github.com/docker/cli/pull/2959)
* 修复了 `WARNING: Error loading config file: .dockercfg: $HOME is not defined` 警告 [docker/cli#2958](https://github.com/docker/cli/pull/2958)

### 运行时

* docker info：静默了无法处理的警告 [moby/moby#41958](https://github.com/moby/moby/pull/41958)
* 避免为 XGlobalHeader 创建父目录 [moby/moby#42017](https://github.com/moby/moby/pull/42017)
* 创建缺失目录时使用 0755 权限 [moby/moby#42017](https://github.com/moby/moby/pull/42017)
* 当镜像配置中没有匹配平台时，回退到清单列表 [moby/moby#42045](https://github.com/moby/moby/pull/42045) [moby/moby#41873](https://github.com/moby/moby/pull/41873)
* 修复了配置了自定义默认运行时的设置中守护进程崩溃的问题 [moby/moby#41974](https://github.com/moby/moby/pull/41974)
* 修复了守护进程配置为空时的崩溃 (panic) 问题 [moby/moby#41976](https://github.com/moby/moby/pull/41976)
* 修复了使用无效设备 cgroup 规则启动容器时守护进程崩溃的问题 [moby/moby#42001](https://github.com/moby/moby/pull/42001)
* 修复了用户名和 UID 匹配时的 userns-remap 选项 [moby/moby#42013](https://github.com/moby/moby/pull/42013)
* 静态包：将 runc 二进制文件更新至 v1.0.0-rc93 [moby/moby#42014](https://github.com/moby/moby/pull/42014)

### 日志记录器 (Logger)

* 即使未设置 `labels`，也尊重 `labels-regex` 配置 [moby/moby#42046](https://github.com/moby/moby/pull/42046)
* 正确处理长日志消息，防止非阻塞模式下的 awslogs 拆分大于 16kB 的事件 [mobymoby#41975](https://github.com/moby/moby/pull/41975)

### 无根模式 (Rootless)

* 通过将 systemd KillMode 设置为 mixed，防止停止时服务挂起 [moby/moby#41956](https://github.com/moby/moby/pull/41956)
* dockerd-rootless.sh：增加了拼写检查 [moby/moby#42070](https://github.com/moby/moby/pull/42070)
* 将 rootlesskit 更新至 v0.13.1，以修复 IPv6 地址的处理 [moby/moby#42025](https://github.com/moby/moby/pull/42025)
* 允许在用户命名空间内进行 FIFO 的 mknod [moby/moby#41957](https://github.com/moby/moby/pull/41957)

### 安全

* 配置：seccomp：更新至 Linux 5.11 系统调用列表 [moby/moby#41971](https://github.com/moby/moby/pull/41971)

### Swarm

* 修复了心跳在重启后无法持久存在的问题 [moby/moby#42060](https://github.com/moby/moby/pull/42060)
* 修复了潜在的停滞任务问题 [moby/moby#42060](https://github.com/moby/moby/pull/42060)
* 修复了仅提供 `--update-order` 或 `--rollback-order` 时的这两个标志位 [docker/cli#2963](https://github.com/docker/cli/pull/2963)
* 修复了在某些情况下 `docker service rollback` 返回非零退出代码的问题 [docker/cli#2964](https://github.com/docker/cli/pull/2964)
* 修复了 `docker service rollback` 中不一致的进度条方向 [docker/cli#2964](https://github.com/docker/cli/pull/2964)


## 20.10.3
2021-02-01

### 安全

* [CVE-2021-21285](https://github.com/moby/moby/security/advisories/GHSA-6fj5-m822-rqx8) 防止无效镜像导致 Docker 守护进程崩溃
* [CVE-2021-21284](https://github.com/moby/moby/security/advisories/GHSA-7452-xqpj-6rpc) 锁定文件权限，防止重新映射的 root 用户访问 Docker 状态
* 确保在使用 BuildKit 构建时应用 AppArmor 和 SELinux 配置文件

### 客户端

* 在导入上下文前对其进行检查，以降低提取文件逃逸出上下文存储的风险
* Windows：防止从当前目录执行某些二进制文件 [docker/cli#2950](https://github.com/docker/cli/pull/2950)

## 20.10.2
2021-01-04

### 运行时

- 修复了在恢复具有重启策略但持续启动失败的容器时，守护进程启动挂起的问题 [moby/moby#41729](https://github.com/moby/moby/pull/41729)
- overlay2：修复了当 data-root 为 24 字节长时阻止构建或运行容器的一个偏移一错误 [moby/moby#41830](https://github.com/moby/moby/pull/41830)
- systemd：关机时发送 `sd_notify STOPPING=1` [moby/moby#41832](https://github.com/moby/moby/pull/41832)

### 联网

- 修复了 IPv6 端口转发问题 [moby/moby#41805](https://github.com/moby/moby/pull/41805) [moby/libnetwork#2604](https://github.com/moby/libnetwork/pull/2604)

### Swarm

- 修复了对 `replicated-job` 和 `global-job` 服务模式的过滤 [moby/moby#41806](https://github.com/moby/moby/pull/41806)

### 打包

- buildx 更新至 [v0.5.1](https://github.com/docker/buildx/releases/tag/v0.5.1) [docker/docker-ce-packaging#516](https://github.com/docker/docker-ce-packaging/pull/516)

## 20.10.1
2020-12-14

### 构建器 (Builder)

- buildkit：更新至 [v0.8.1](https://github.com/moby/buildkit/releases/tag/v0.8.1)，包含多项 bug 修复 [moby/moby#41793](https://github.com/moby/moby/pull/41793)

### 打包

- 还原了 systemd 单元文件中的一项更改，该更改曾可能因启动顺序冲突导致 Docker 无法启动 [docker/docker-ce-packaging#514](https://github.com/docker/docker-ce-packaging/pull/514)
- buildx 更新至 [v0.5.0](https://github.com/docker/buildx/releases/tag/v0.5.0) [docker/docker-ce-packaging#515](https://github.com/docker/docker-ce-packaging/pull/515)

## 20.10.0
2020-12-08

### 弃用 / 移除

有关所有已弃用功能的概览，请参阅 [已弃用的 Engine 功能](/engine/deprecated/) 页面。

- 从不支持按摘要拉取的非标准注册表执行 `docker pull` 时，增加了警告和弃用通知 [docker/cli#2872](https://github.com/docker/cli/pull/2872)
- 针对未经过身份验证的 TCP 访问增加了更严厉的警告和弃用通知 [moby/moby#41285](https://github.com/moby/moby/pull/41285)
- 弃用 KernelMemory (`docker run --kernel-memory`) [moby/moby#41254](https://github.com/moby/moby/pull/41254) [docker/cli#2652](https://github.com/docker/cli/pull/2652)
- 弃用 `aufs` 存储驱动程序 [docker/cli#1484](https://github.com/docker/cli/pull/1484)
- 弃用使用外部 k/v 存储的主机发现和 overlay 网络 [moby/moby#40614](https://github.com/moby/moby/pull/40614) [moby/moby#40510](https://github.com/moby/moby/pull/40510)
- 弃用 Dockerfile 传统的 'ENV name value' 语法，请改用 `ENV name=value` [docker/cli#2743](https://github.com/docker/cli/pull/2743)
- 对于 API v1.41 及更高版本，移除了已弃用的 "filter" 参数 [moby/moby#40491](https://github.com/moby/moby/pull/40491)
- 推送时禁用了分发清单 v2 schema 1 [moby/moby#41295](https://github.com/moby/moby/pull/41295)
- 移除了会破坏旧版 Docker 客户端 (<= 1.12) 的 MalformedHostHeaderOverride 补丁，在这种情况下请设置 `DOCKER_API_VERSION` [moby/moby#39076](https://github.com/moby/moby/pull/39076)
- 移除了 "docker engine" 子命令 [docker/cli#2207](https://github.com/docker/cli/pull/2207)
- 从 "dab" 文件中移除了实验性的 "deploy" 功能 [docker/cli#2216](https://github.com/docker/cli/pull/2216)
- 移除了已弃用的 `docker search --automated` 和 `--stars` 标志 [docker/cli#2338](https://github.com/docker/cli/pull/2338)
- 不再允许在 Engine 标签中使用保留的命名空间 [docker/cli#2326](https://github.com/docker/cli/pull/2326)

### API

- 将 API 版本更新至 v1.41
- 指标 (metrics) API 不再需要“实验性”标志 [moby/moby#40427](https://github.com/moby/moby/pull/40427)
- `GET /events` 现在会在资源清理完成后返回 `prune` 事件 [moby/moby#41259](https://github.com/moby/moby/pull/41259)
  - 为 `container`、`network`、`volume`、`image` 和 `builder` 返回 prune 事件，并带有 `reclaimed` 属性，指示回收的空间量 (以字节为单位)
- 增加了 `one-shot` 统计选项，不预热统计数据 [moby/moby#40478](https://github.com/moby/moby/pull/40478)
- 向系统信息 API (`/info`) 增加了操作系统版本信息 [moby/moby#38349](https://github.com/moby/moby/pull/38349)
- 向 docker info 增加了 DefaultAddressPools [moby/moby#40714](https://github.com/moby/moby/pull/40714)
- 为服务增加了 API 对 PidsLimit 的支持 [moby/moby#39882](https://github.com/moby/moby/pull/39882)

### 构建器 (Builder)

- buildkit, dockerfile：支持 `RUN --mount` 选项，无需指定实验性的 dockerfile `#syntax` 指令。[moby/buildkit#1717](https://github.com/moby/buildkit/pull/1717)
- dockerfile：`ARG` 命令现在支持在同一行定义多个构建参数，类似于 `ENV` [moby/buildkit#1692](https://github.com/moby/buildkit/pull/1692)
- dockerfile：`ADD` 中的 `--chown` 标志现在允许参数扩展 [moby/buildkit#1473](https://github.com/moby/buildkit/pull/1473)
- buildkit：获取身份验证令牌已移动到客户端 (如果客户端支持)。密码不再泄漏到构建守护进程中，用户可以从构建输出中看到何时访问了凭据或令牌。[moby/buildkit#1660](https://github.com/moby/buildkit/pull/1660)
- buildkit：与注册表进行推送和拉取通信时的连接错误现在会触发重试 [moby/buildkit#1791](https://github.com/moby/buildkit/pull/1791)
- buildkit：Git 源现在支持通过构建机密 (build secrets) 进行令牌身份验证 [moby/moby#41234](https://github.com/moby/moby/pull/41234) [docker/cli#2656](https://github.com/docker/cli/pull/2656) [moby/buildkit#1533](https://github.com/moby/buildkit/pull/1533)
- buildkit：从 Git 源构建现在支持转发 SSH 套接字进行身份验证 [moby/buildkit#1782](https://github.com/moby/buildkit/pull/1782)
- buildkit：避免产生过多日志的构建导致崩溃或构建变慢。必要时执行剪裁 (clipping)。[moby/buildkit#1754](https://github.com/moby/buildkit/pull/1754)
- buildkit：将默认的 Seccomp 配置文件更改为 Docker 提供的配置文件 [moby/buildkit#1807](https://github.com/moby/buildkit/pull/1807)
- buildkit：改进了在 Windows 上暴露 SSH 代理套接字的支持 [moby/buildkit#1695](https://github.com/moby/buildkit/pull/1695)
- buildkit：使用 `--progress=plain` 时默认禁用截断 [moby/buildkit#1435](https://github.com/moby/buildkit/pull/1435)
- buildkit：在多个构建共享客户端会话时，能够更好地处理会话掉线的情况 [moby/buildkit#1551](https://github.com/moby/buildkit/pull/1551)
- buildkit：机密 (secrets)：允许使用环境变量提供机密 [moby/moby#41234](https://github.com/moby/moby/pull/41234) [docker/cli#2656](https://github.com/docker/cli/pull/2656) [moby/buildkit#1534](https://github.com/moby/buildkit/pull/1534)
  - 支持 `--secret id=foo,env=MY_ENV` 作为将机密值存储到文件的替代方案。
  - `--secret id=GIT_AUTH_TOKEN` 在文件不存在时将尝试加载环境变量。
- buildkit：支持镜像回退、不安全 TLS 和自定义 TLS 配置 [moby/moby#40814](https://github.com/moby/moby/pull/40814)
- buildkit：remotecache：遍历结果时每项仅访问一次 [moby/moby#41234](https://github.com/moby/moby/pull/41234) [moby/buildkit#1577](https://github.com/moby/buildkit/pull/1577)
  - 提高了在较大型图上的性能并降低了 CPU 占用。
- buildkit：本地镜像平台不匹配时检查远程端 [moby/moby#40629](https://github.com/moby/moby/pull/40629)
- buildkit：镜像导出：创建新层 blobs 时使用正确的媒体类型 [moby/moby#41234](https://github.com/moby/moby/pull/41234) [moby/buildkit#1541](https://github.com/moby/buildkit/pull/1541)
- buildkit：progressui：修复了日志时间格式化 [moby/moby#41234](https://github.com/moby/moby/pull/41234) [docker/cli#2656](https://github.com/docker/cli/pull/2656) [moby/buildkit#1549](https://github.com/moby/buildkit/pull/1549)
- buildkit：减轻了并行推送时的 containerd 问题 [moby/moby#41234](https://github.com/moby/moby/pull/41234) [moby/buildkit#1548](https://github.com/moby/buildkit/pull/1548)
- buildkit：内联缓存：修复了对重复 blobs 的处理 [moby/moby#41234](https://github.com/moby/moby/pull/41234) [moby/buildkit#1568](https://github.com/moby/buildkit/pull/1568)
  - 修复了 https://github.com/moby/buildkit/issues/1388 缓存从工作不稳定的问题。
  - 修复了 https://github.com/moby/moby/issues/41219 从缓存层构建的镜像缺失数据的问题。
- 允许在远程上下文 URL 中使用 ssh:// [moby/moby#40179](https://github.com/moby/moby/pull/40179)
- 构建器 (builder)：移除了旧版构建的会话处理 (之前是实验性的) [moby/moby#39983](https://github.com/moby/moby/pull/39983)

### 客户端

- 为 CLI 增加了 Swarm 作业支持 [docker/cli#2262](https://github.com/docker/cli/pull/2262)
- 为 `docker push` 增加了 `-a/--all-tags` 标志 [docker/cli#2220](https://github.com/docker/cli/pull/2220)
- 增加了对 Kubernetes 用户名/密码认证的支持 [docker/cli#2308](https://github.com/docker/cli/pull/2308)
- 为 `run` 和 `create` 命令增加了 `--pull=missing|always|never` [docker/cli#1498](https://github.com/docker/cli/pull/1498)
- 为 `docker exec` 增加了 `--env-file` 标志，用于从文件中解析环境变量 [docker/cli#2602](https://github.com/docker/cli/pull/2602)
- 为 `--tail` 选项增加了简写 `-n` [docker/cli#2646](https://github.com/docker/cli/pull/2646)
- 向服务检查 (service inspect) 的 "pretty" 格式增加了日志驱动程序和选项 [docker/cli#1950](https://github.com/docker/cli/pull/1950)
- `docker run`：使用 `--cgroupns` 指定 cgroup 命名空间模式 [docker/cli#2024](https://github.com/docker/cli/pull/2024)
- `docker manifest rm` 命令用于从本地存储中移除清单列表草稿 [docker/cli#2449](https://github.com/docker/cli/pull/2449)
- 为 "docker version" 和 "docker info" 增加了 "context" 字段 [docker/cli#2500](https://github.com/docker/cli/pull/2500)
- 将平台标志传播到容器创建 API [docker/cli#2551](https://github.com/docker/cli/pull/2551)
- `docker ps --format` 标志现在有一个 `.State` 占位符，用于在不带运行时间和健康检查细节的情况下打印容器状态 [docker/cli#2000](https://github.com/docker/cli/pull/2000)
- 增加了对 docker-compose 模式 v3.9 的支持 [docker/cli#2073](https://github.com/docker/cli/pull/2073)
- 增加了对 `docker push --quiet` 的支持 [docker/cli#2197](https://github.com/docker/cli/pull/2197)
- 如果启用了 BuildKit，则隐藏 BuildKit 不支持的标志 [docker/cli#2123](https://github.com/docker/cli/pull/2123)
- 更新了 `docker rm -v` 的标志说明，以澄清该选项仅移除匿名 (未命名) 卷 [docker/cli#2289](https://github.com/docker/cli/pull/2289)
- 改进了 Docker 服务任务的打印显示 [docker/cli#2341](https://github.com/docker/cli/pull/2341)
- `docker info`：按字母顺序排列 CLI 插件列表 [docker/cli#2236](https://github.com/docker/cli/pull/2236)
- 修复了 `docker service update` 上 `--label-add/--label-rm`、`--container-label-add/--container-label-rm` 和 `--env-add/--env-rm` 标志的处理顺序，以允许替换现有值 [docker/cli#2668](https://github.com/docker/cli/pull/2668)
- 修复了如果一个或多个容器不存在时 `docker rm --force` 返回非零退出代码的问题 [docker/cli#2678](https://github.com/docker/cli/pull/2678)
- 通过使用 `total_inactive_file` 代替 `cache` 改进了内存统计显示 [docker/cli#2415](https://github.com/docker/cli/pull/2415)
- 防范具有过度别名的 YAML 文件 [docker/cli#2117](https://github.com/docker/cli/pull/2117)
- 允许在仅设置 source 字段的情况下使用高级语法设置 config 或 secret [docker/cli#2243](https://github.com/docker/cli/pull/2243)
- 即使 auth 为空，也修复了读取包含 `username` 和 `password` auth 的配置文件的问题 [docker/cli#2122](https://github.com/docker/cli/pull/2122)
- `docker cp`：防止在获取目标状态失败时发生空指针异常 (NPE) [docker/cli#2221](https://github.com/docker/cli/pull/2221)
- 配置：在配置文件上保留所有权和权限 [docker/cli#2228](https://github.com/docker/cli/pull/2228)

### 日志记录 (Logging)

- 支持使用所有日志驱动程序读取 `docker logs` (尽力而为) [moby/moby#40543](https://github.com/moby/moby/pull/40543)
- 增加了 `splunk-index-acknowledgment` 日志选项，以配合启用了索引确认的 Splunk HECs [moby/moby#39987](https://github.com/moby/moby/pull/39987)
- 向 journald 日志增加了部分元数据 [moby/moby#41407](https://github.com/moby/moby/pull/41407)
- 减少了日志文件读取器的分配 [moby/moby#40796](https://github.com/moby/moby/pull/40796)
- Fluentd：增加了 `fluentd-async`、`fluentd-request-ack`，并弃用了 `fluentd-async-connect` [moby/moby#39086](https://github.com/moby/moby/pull/39086)

### 运行时 (Runtime)

- 支持 cgroup2 [moby/moby#40174](https://github.com/moby/moby/pull/40174) [moby/moby#40657](https://github.com/moby/moby/pull/40657) [moby/moby#40662](https://github.com/moby/moby/pull/40662)
- cgroup2：可用时默认使用 "systemd" cgroup 驱动程序 [moby/moby#40846](https://github.com/moby/moby/pull/40846)
- 新存储驱动程序：`fuse-overlayfs` [moby/moby#40483](https://github.com/moby/moby/pull/40483)
- 将 containerd 二进制文件更新至 v1.4.3 [moby/moby#41732](https://github.com/moby/moby/pull/41732)
- `docker push` 现在默认推送 `latest` 标签，而不是所有标签 [moby/moby#40302](https://github.com/moby/moby/pull/40302)
- 通过在配置文件中添加 `max-download-attempts`，增加了在拉取镜像期间连接丢失时更改重连尝试次数的能力 [moby/moby#39949](https://github.com/moby/moby/pull/39949)
- 通过使用现在的默认 `io.containerd.runc.v2` 运行时，增加了对 containerd v2 shim 的支持 [moby/moby#41182](https://github.com/moby/moby/pull/41182)
- cgroup v1：将默认运行时更改为 `io.containerd.runc.v2`。需要 containerd v1.3.0 或更高版本。推荐 v1.3.5 或更高版本 [moby/moby#41210](https://github.com/moby/moby/pull/41210)
- 在各自的 cgroup 命名空间内启动容器 [moby/moby#38377](https://github.com/moby/moby/pull/38377)
- 为 CIFS 卷启用了 DNS 查找 [moby/moby#39250](https://github.com/moby/moby/pull/39250)
- 使用 `MemAvailable` 而非 `MemFree` 来估算实际可用内存 [moby/moby#39481](https://github.com/moby/moby/pull/39481)
- `docker run` 中的 `--device` 标志现在在容器以特权模式启动时也将生效 [moby/moby#40291](https://github.com/moby/moby/pull/40291)
- 强制执行保留的内部标签 [moby/moby#40394](https://github.com/moby/moby/pull/40394)
- 将最低内存限制提高到 6M，以解决运行时在容器启动期间较高的内存消耗 [moby/moby#41168](https://github.com/moby/moby/pull/41168)
- 引用 runc v1.0.0-rc92 [moby/moby#41344](https://github.com/moby/moby/pull/41344) [moby/moby#41317](https://github.com/moby/moby/pull/41317)
- info：增加了有关缺失 blkio cgroup 支持的警告 [moby/moby#41083](https://github.com/moby/moby/pull/41083)
- 容器创建时接受平台规格 [moby/moby#40725](https://github.com/moby/moby/pull/40725)
- 修复了查找包含空格的用户名和组名的问题 [moby/moby#41377](https://github.com/moby/moby/pull/41377)

### 联网

- 在 Linux 版 dockerd 中支持 `host.docker.internal` [moby/moby#40007](https://github.com/moby/moby/pull/40007)
- 在 `/etc/hosts` 中包含了已链接容器的 IPv6 地址 [moby/moby#39837](https://github.com/moby/moby/pull/39837)
- `--ip6tables` 启用 IPv6 iptables 规则 (仅限实验性) [moby/moby#41622](https://github.com/moby/moby/pull/41622)
- 如果 `hostname != container name`，则为 hostname 增加别名 [moby/moby#39204](https://github.com/moby/moby/pull/39204)
- 更好的 DNS 服务器选择 (配合 systemd) [moby/moby#41022](https://github.com/moby/moby/pull/41022)
- 将 Docker 接口添加到 firewalld 的 docker 区域 [moby/moby#41189](https://github.com/moby/moby/pull/41189) [moby/libnetwork#2548](https://github.com/moby/libnetwork/pull/2548)
  - 修复了 CentOS 8 上的 DNS 问题 [docker/for-linux#957](https://github.com/docker/for-linux/issues/957)
  - 修复了运行带有 `FirewallBackend=nftables` 的 Firewalld 的 RHEL 8 上的端口转发问题 [moby/libnetwork#2496](https://github.com/moby/libnetwork/issues/2496)
- 修复了一个报告 'failed to get network during CreateEndpoint' 的问题 [moby/moby#41189](https://github.com/moby/moby/pull/41189) [moby/libnetwork#2554](https://github.com/moby/libnetwork/pull/2554)
- 如果 IPv6 路由通告失败，记录错误而不是禁用 [moby/moby#41189](https://github.com/moby/moby/pull/41189) [moby/libnetwork#2563](https://github.com/moby/libnetwork/pull/2563)
- 在某些情况下不再忽略 `--default-address-pool` 选项 [moby/moby#40711](https://github.com/moby/moby/pull/40711)
- 无效地址池时产生错误 [moby/moby#40808](https://github.com/moby/moby/pull/40808) [moby/libnetwork#2538](https://github.com/moby/libnetwork/pull/2538)
- 修复了 `IPTableEnable=false` 时未创建 `DOCKER-USER` 链的问题 [moby/moby#40808](https://github.com/moby/moby/pull/40808) [moby/libnetwork#2471](https://github.com/moby/libnetwork/pull/2471)
- 修复了 systemd 环境下启动时的崩溃 (panic) [moby/moby#40808](https://github.com/moby/moby/pull/40808) [moby/libnetwork#2544](https://github.com/moby/libnetwork/pull/2544)
- 修复了阻止容器通过 macvlan 内部网络通信的问题 [moby/moby#40596](https://github.com/moby/moby/pull/40596) [moby/libnetwork#2407](https://github.com/moby/libnetwork/pull/2407)
- 修复了 `InhibitIPv4` 空指针崩溃 [moby/moby#40596](https://github.com/moby/moby/pull/40596)
- 修复了 Windows overlay 网络删除过程中的 VFP 泄漏 [moby/moby#40596](https://github.com/moby/moby/pull/40596) [moby/libnetwork#2524](https://github.com/moby/libnetwork/pull/2524)

### 打包

- docker.service：在单元文件的 `After=` 中增加了 `multi-user.target` [moby/moby#41297](https://github.com/moby/moby/pull/41297)
- docker.service：允许套接字激活 (socket activation) [moby/moby#37470](https://github.com/moby/moby/pull/37470)
- seccomp：移除了 dockerd 对 libseccomp 的依赖 [moby/moby#41395](https://github.com/moby/moby/pull/41395)

### 无根模式 (Rootless)

- rootless：从实验性毕业 [moby/moby#40759](https://github.com/moby/moby/pull/40759)
- 增加了 `dockerd-rootless-setuptool.sh` [moby/moby#40950](https://github.com/moby/moby/pull/40950)
- 支持 `--exec-opt native.cgroupdriver=systemd` [moby/moby#40486](https://github.com/moby/moby/pull/40486)

### 安全

- 修复了 Glibc 下 chroot 内部加载基于 nsswitch 配置的 CVE-2019-14271 漏洞 [moby/moby#39612](https://github.com/moby/moby/pull/39612)
- seccomp：将 `clock_adjtime` 列入白名单。调整时间仍需 `CAP_SYS_TIME` [moby/moby#40929](https://github.com/moby/moby/pull/40929)
- seccomp：向默认 seccomp 配置文件增加了 `openat2` 和 `faccessat2` [moby/moby#41353](https://github.com/moby/moby/pull/41353)
- seccomp：在默认 seccomp 配置文件中允许 `rseq` 系统调用 [moby/moby#41158](https://github.com/moby/moby/pull/41158)
- seccomp：允许 `membarrier` 系统调用 [moby/moby#40731](https://github.com/moby/moby/pull/40731)
- seccomp：将 io-uring 相关系统调用列入白名单 [moby/moby#39415](https://github.com/moby/moby/pull/39415)
- 增加了默认的 sysctls，以在没有能力的情况下允许 ping 套接字和特权端口 [moby/moby#41030](https://github.com/moby/moby/pull/41030)
- 修复了 `clone` 系统调用的 seccomp 配置文件 [moby/moby#39308](https://github.com/moby/moby/pull/39308)

### Swarm

- 增加了对 Swarm 作业 (swarm jobs) 的支持 [moby/moby#40307](https://github.com/moby/moby/pull/40307)
- 为 stack/service 命令增加了 capabilities (能力) 支持 [docker/cli#2687](https://github.com/docker/cli/pull/2687) [docker/cli#2709](https://github.com/docker/cli/pull/2709) [moby/moby#39173](https://github.com/moby/moby/pull/39173) [moby/moby#41249](https://github.com/moby/moby/pull/41249)
- 增加了对发送服务运行中和期望任务计数支持 [moby/moby#39231](https://github.com/moby/moby/pull/39231)
- service：支持 `--mount type=bind,bind-nonrecursive` [moby/moby#38788](https://github.com/moby/moby/pull/38788)
- 在 Swarm 服务上支持 ulimits。[moby/moby#41284](https://github.com/moby/moby/pull/41284) [docker/cli#2712](https://github.com/docker/cli/pull/2712)
- 修复了一个问题，即服务日志可能会在工作节点上泄漏 goroutines [moby/moby#40426](https://github.com/moby/moby/pull/40426)
