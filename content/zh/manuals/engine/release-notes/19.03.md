---
title: Docker Engine 19.03 发布说明
linkTitle: Engine v19.03
toc_min: 1
toc_max: 2
---

本页描述了 Docker Engine 19.03 版的最新变更、新增内容、已知问题和修复。

## 19.03.15
2021-02-01

### 安全

* [CVE-2021-21285](https://github.com/moby/moby/security/advisories/GHSA-6fj5-m822-rqx8) 防止无效镜像导致 Docker 守护进程崩溃。
* [CVE-2021-21284](https://github.com/moby/moby/security/advisories/GHSA-7452-xqpj-6rpc) 锁定文件权限，防止重新映射的 root 用户访问 Docker 状态。
* 确保在使用 BuildKit 构建时应用 AppArmor 和 SELinux 配置文件。

### 客户端

* 在导入上下文 (contexts) 前对其进行检查，以降低提取文件逃逸出上下文存储的风险。

## 19.03.14
2020-12-01

### 安全

- [CVE-2020-15257](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-15257)：将捆绑的 containerd 静态二进制文件更新至 v1.3.9 [moby/moby#41731](https://github.com/moby/moby/pull/41731)。软件包管理器应更新 containerd.io 软件包。

### 构建器 (Builder)

- 现在可以正确解析 AppArmor 的 Beta 版本，防止构建失败 [moby/moby#41542](https://github.com/moby/moby/pull/41542)。

### 联网

- 修复了 swarmkit 服务持续启动失败时的崩溃 (panic) 问题 [moby/moby#41635](https://github.com/moby/moby/pull/41635)。

### 运行时

- 返回正确的错误信息，而不是虚假的 -EINVAL [moby/moby#41293](https://github.com/moby/moby/pull/41293)。

### 无根模式 (Rootless)

- 锁定状态目录，防止被 systemd-tmpfiles 自动清理 [moby/moby#41635](https://github.com/moby/moby/pull/41635)。
- `dockerd-rootless.sh`：支持新的 containerd shim 套接字路径约定 [moby/moby#41557](https://github.com/moby/moby/pull/41557)。

### 日志记录

- gcplogs：修复内存/连接泄漏 [moby/moby#41522](https://github.com/moby/moby/pull/41522)。
- awslogs：支持 AWS imdsv2 [moby/moby#41494](https://github.com/moby/moby/pull/41494)。

## 19.03.13
2020-09-16

### 构建器 (Builder)

- buildkit：修复缓存逻辑中的空指针引用 [moby/moby#41279](https://github.com/moby/moby/pull/41279)。
- buildkit：在 COPY/ADD 期间将 Unix 套接字视为常规文件 [moby/moby#41269](https://github.com/moby/moby/pull/41269)。
- buildkit：在计算中忽略 system 和 security xattrs，以确保无论 SELinux 环境如何都能获得一致的 COPY 缓存 [moby/moby#41222](https://github.com/moby/moby/pull/41222)。
- buildkit：使 `--cache-from` 行为更可靠 [moby/moby#41222](https://github.com/moby/moby/pull/41222)。
- buildkit：修复导出缓存时导致 CPU 占用的无限循环 [moby/moby#41185](https://github.com/moby/moby/pull/41185)。

### 客户端

- 升级至 Golang 1.13.15 [docker/cli#2674](https://github.com/docker/cli/pull/2674)。
- 修复配置文件权限问题 (`~/.docker/config.json`) [docker/cli#2631](https://github.com/docker/cli/pull/2631)。
- build：修复高度为零的终端上的崩溃 (panic) [docker/cli#2719](https://github.com/docker/cli/pull/2719)。
- windows：修复控制台中换行符的潜在问题 [docker/cli#2623](https://github.com/docker/cli/pull/2623)。

### 联网

- 失败时清理网络沙箱 [moby/moby#41081](https://github.com/moby/moby/pull/41081)。
- 通过向用户转发与截止日期相关的错误，修复表层错误消息 [moby/moby#41312](https://github.com/moby/moby/pull/41312)。
- 修复 netns 文件描述符泄漏 [moby/moby#41287](https://github.com/moby/moby/pull/41287)。

### 无根模式 (Rootless)

- 修复端口转发器资源泄漏 [moby/moby#41277](https://github.com/moby/moby/pull/41277)。

### 运行时

- 升级至 Golang 1.13.15 [moby/moby#41334](https://github.com/moby/moby/pull/41334)。
- 更新至 containerd 1.3.7 [moby/moby#40408](https://github.com/moby/moby/pull/40408)。

### Windows

- 修复了使用 servercore 镜像时 Windows 容器启动慢的问题 [moby/moby#41192](https://github.com/moby/moby/pull/41192)。

## 19.03.12
2020-06-18

### 客户端

- 修复了在使用多个配置文件 (例如在使用 Docker Desktop 时 Windows 与 WSL2 之间) 时阻止从注册表注销的 bug [docker/cli#2592](https://github.com/docker/cli/pull/2592)。
- 修复了阻止读取上下文元数据的回归问题 [docker/cli#2586](https://github.com/docker/cli/pull/2586)。
- 升级至 Golang 1.13.12 [docker/cli#2575](https://github.com/docker/cli/pull/2575)。

### 联网

- 修复了阻止守护进程在 systemd-nspawn 环境下启动的回归问题 [moby/moby#41124](https://github.com/moby/moby/pull/41124) [moby/libnetwork#2567](https://github.com/moby/libnetwork/pull/2567)。
- 修复了 Swarm 中创建 overlay 网络的重试逻辑 [moby/moby#41124](https://github.com/moby/moby/pull/41124) [moby/libnetwork#2565](https://github.com/moby/libnetwork/pull/2565)。

### 运行时

- 升级至 Golang 1.13.12 [moby/moby#41082](https://github.com/moby/moby/pull/41082)。


## 19.03.11
2020-06-01

### 联网

禁用 IPv6 路由通告 (Router Advertisements) 以防止地址欺骗。[CVE-2020-13401](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13401)

**描述**

在 Docker 默认配置中，容器网络接口是通往主机的虚拟以太网链路 (veth 接口)。在此配置下，能够以 root 身份在容器内运行进程的攻击者，可以使用 `CAP_NET_RAW` 能力 (默认配置中包含) 向主机发送和接收任意数据包。

如果主机上没有完全禁用 IPv6 (通过内核命令行上的 `ipv6.disable=1`)，它要么未配置，要么在某些接口上配置了 IPv6，但很可能禁用了 IPv6 转发，即 `/proc/sys/net/ipv6/conf/<接口>/forwarding == 0`。此外，默认情况下 `/proc/sys/net/ipv6/conf/<接口>/accept_ra == 1`。这两个 sysctl 组合意味着主机接受路由通告并使用它们配置 IPv6 栈。

通过从容器发送“流氓”路由通告，攻击者可以重新配置主机，将其部分或全部 IPv6 流量重定向到受攻击者控制的容器中。

即使之前没有 IPv6 流量，如果 DNS 返回 A (IPv4) 和 AAAA (IPv6) 记录，许多 HTTP 库会尝试先通过 IPv6 连接，然后回退到 IPv4，从而给攻击者提供了响应的机会。如果运气好，主机存在类似于去年 apt 中的 RCE 漏洞 (CVE-2019-3462)，攻击者现在就可以提升至主机。

由于 Docker 容器默认不具备 `CAP_NET_ADMIN` 能力，攻击者无法配置他们想要进行中间人攻击 (MitM) 的 IP，无法使用 iptables 进行 NAT 或重定向流量，也无法使用 `IP_TRANSPARENT`。然而，攻击者仍然可以使用 `CAP_NET_RAW` 并在用户空间实现 tcp/ip 栈。

有关相关问题，请参阅 [kubernetes/kubernetes#91507](https://github.com/kubernetes/kubernetes/issues/91507)。

## 19.03.10
2020-05-29

### 客户端
- 修复了与旧版本 Engine 的版本协商问题 [docker/cli#2538](https://github.com/docker/cli/pull/2538)。
- 避免通过主机名设置 SSH 标志 [docker/cli#2560](https://github.com/docker/cli/pull/2560)。
- 修复了当 `DOCKER_CLI_EXPERIMENTAL` 无效时的崩溃 (panic) [docker/cli#2558](https://github.com/docker/cli/pull/2558)。
- 通过将 Go 升级至 1.13.11，避免了 s390x 上潜在的崩溃 [docker/cli#2532](https://github.com/docker/cli/pull/2532)。

### 联网
- 修复了 DNS 回退的回归问题 [moby/moby#41009](https://github.com/moby/moby/pull/41009)。

### 运行时
- 通过将 Go 升级至 1.13.11，避免了 s390x 上潜在的崩溃 [moby/moby#40978](https://github.com/moby/moby/pull/40978)。

### 打包
- 修复了 ARM64 上的 ARM 构建问题 [moby/moby#41027](https://github.com/moby/moby/pull/41027)。

## 19.03.9
2020-05-14

### 构建器 (Builder)
- buildkit：修复了并行构建多个镜像时并发写入 map 的崩溃 (panic) [moby/moby#40780](https://github.com/moby/moby/pull/40780)。
- buildkit：修复了在启用 userns 的阶段之间阻止修改非 root 拥有文件所有权的问题 [moby/moby#40955](https://github.com/moby/moby/pull/40955)。
- 避免在 Windows 上创建无关的临时文件 [moby/moby#40877](https://github.com/moby/moby/pull/40877)。

### 客户端
- 修复了单字符卷名导致的崩溃 [docker/cli#2471](https://github.com/docker/cli/pull/2471)。
- 延迟守护进程功能探测，以避免简单命令上的长超时 [docker/cli#2442](https://github.com/docker/cli/pull/2442)。
- Windows 上的 `docker context inspect` 现在更快了 [docker/cli#2516](https://github.com/docker/cli/pull/2516)。
- 升级至 Golang 1.13.10 [docker/cli#2431](https://github.com/docker/cli/pull/2431)。
- 升级 `gopkg.in/yaml.v2` 至 v2.2.8 [docker/cli#2470](https://github.com/docker/cli/pull/2470)。

### 日志记录
- 避免因关闭已关闭的日志文件而导致容器日志无法轮转的情况 [moby/moby#40921](https://github.com/moby/moby/pull/40921)。

### 联网
- 修复了重启时潜在的崩溃 (panic) [moby/moby#40809](https://github.com/moby/moby/pull/40809)。
- 为默认桥接网络的 Subnet 字段分配了正确的网络值 [moby/moby#40565](https://github.com/moby/moby/pull/40565)。

### 运行时
- 修复了在 `/etc/subuid` 和 `/etc/subgid` 中使用 UID 创建命名空间时发生的 Docker 崩溃 [moby/moby#40562](https://github.com/moby/moby/pull/40562)。
- 改进了 ARM 平台匹配 [moby/moby#40758](https://github.com/moby/moby/pull/40758)。
- overlay2：显示底层文件系统 [moby/moby#40652](https://github.com/moby/moby/pull/40652)。
- 将 CRIU 更新至 v3.13 "Silicon Willet" [moby/moby#40850](https://github.com/moby/moby/pull/40850)。
- 仅在成功回退时显示注册表 v2 schema1 弃用警告，而不是任何注册表错误时都显示 [moby/moby#40681](https://github.com/moby/moby/pull/40681)。
- 在 Windows 上为日志文件使用 `FILE_SHARE_DELETE` [moby/moby#40563](https://github.com/moby/moby/pull/40563)。
- 升级至 Golang 1.13.10 [moby/moby#40803](https://github.com/moby/moby/pull/40803)。

### 无根模式 (Rootless)
- 现在 `rootlesskit-docker-proxy` 在暴露特权端口时返回详细的错误消息 [moby/moby#40863](https://github.com/moby/moby/pull/40863)。
- 在 `/etc/subuid` 和 `/etc/subgid` 中支持数值 ID [moby/moby#40951](https://github.com/moby/moby/pull/40951)。

### 安全
- apparmor：增加了缺少的 userns 规则 [moby/moby#40564](https://github.com/moby/moby/pull/40564)。
- SELinux：修复了重新打标时未检测到 `ENOTSUP` 错误的问题 [moby/moby#40946](https://github.com/moby/moby/pull/40946)。

### Swarm
- 提高了日志记录器的填充速率，以避免服务日志挂起 [moby/moby#40628](https://github.com/moby/moby/pull/40628)。
- 修复了单管理节点 Swarm 在重启后卡在 Down 状态的问题 [moby/moby#40831](https://github.com/moby/moby/pull/40831)。
- `tasks.db` 不再无限增长 [moby/moby#40831](https://github.com/moby/moby/pull/40831)。

## 19.03.8
2020-03-10

### 运行时

- 改进了针对某些 nscd 配置的 [CVE-2019-14271](https://nvd.nist.gov/vuln/detail/CVE-2019-14271) 的缓解措施。

## 19.03.7
2020-03-03

### 构建器 (Builder)

- builder-next：修复了极端情况下的死锁问题 [moby/moby#40557](https://github.com/moby/moby/pull/40557)。

### 运行时

* overlay：移除了 modprobe 调用 [moby/moby#40462](https://github.com/moby/moby/pull/40462)。
* selinux：设置文件标签时显示更好的错误消息 [moby/moby#40547](https://github.com/moby/moby/pull/40547)。
* 加快了初始统计信息的收集速度 [moby/moby#40549](https://github.com/moby/moby/pull/40549)。
- 无根模式：从 `XDG_CONFIG_HOME` 使用 `certs.d` [moby/moby#40461](https://github.com/moby/moby/pull/40461)。
- 升级至 Golang 1.12.17 [moby/moby#40533](https://github.com/moby/moby/pull/40533)。
- 升级 `google.golang.org/grpc` 至 v1.23.1 [moby/moby#40566](https://github.com/moby/moby/pull/40566)。
- 将 containerd 二进制文件更新至 v1.2.13 [moby/moby#40540](https://github.com/moby/moby/pull/40540)。
- 防止在边缘情况下将已停止的容器显示为正在运行 [moby/moby#40555](https://github.com/moby/moby/pull/40555)。
- 防止潜在的死锁 [moby/moby#40604](https://github.com/moby/moby/pull/40604)。

### 客户端

- 升级至 Golang 1.12.17 [docker/cli#2342](https://github.com/docker/cli/pull/2342)。
- 升级 `google.golang.org/grpc` 至 v1.23.1 [docker/cli#1884](https://github.com/docker/cli/pull/1884) [docker/cli#2373](https://github.com/docker/cli/pull/2373)。

## 19.03.6
2020-02-12

### 构建器 (Builder)

- builder-next：允许 SSH 转发使用现代签名哈希 [docker/engine#453](https://github.com/docker/engine/pull/453)。
- builder-next：在触发后清除 onbuild 规则 [docker/engine#453](https://github.com/docker/engine/pull/453)。
- builder-next：修复了启用用户命名空间时的目录权限问题 [moby/moby#40440](https://github.com/moby/moby/pull/40440)。
- 升级 hcsshim 以修复 Windows 1903 上 `docker build` 失败的问题 [docker/engine#429](https://github.com/docker/engine/pull/429)。

### 联网

- 缩短了 exec-root 中的控制器 ID，以避免超出 `UNIX_PATH_MAX` [docker/engine#424](https://github.com/docker/engine/pull/424)。
- 修复了 `drivers/overlay/encryption.go` 中的崩溃 (panic) [docker/engine#424](https://github.com/docker/engine/pull/424)。
- 修复了我们与 udev 之间的 hwaddr 设置竞态条件 [docker/engine#439](https://github.com/docker/engine/pull/439)。

### 运行时

* 升级至 Golang 1.12.16 [moby/moby#40433](https://github.com/moby/moby/pull/40433)。
* 将 containerd 二进制文件更新至 v1.2.12 [moby/moby#40433](https://github.com/moby/moby/pull/40453)。
* 更新至 runc v1.0.0-rc10 [moby/moby#40433](https://github.com/moby/moby/pull/40453)。
- 修复了 `Lgetxattr` 中可能的运行时崩溃 (panic) [docker/engine#454](https://github.com/docker/engine/pull/454)。
- 无根模式：修复了代理 UDP 数据包的问题 [docker/engine#434](https://github.com/docker/engine/pull/434)。

## 19.03.5
2019-11-14

### 构建器 (Builder)

* builder-next：在构建器配置中增加了 `entitlements` [docker/engine#412](https://github.com/docker/engine/pull/412)。
* 修复了 builder-next：在使用带 userns-remap 的构建机密或 SSH 转发时的权限错误 [docker/engine#420](https://github.com/docker/engine/pull/420)。
* 修复了 builder-next：在已复制的目录内复制符号链接的问题 [docker/engine#420](https://github.com/docker/engine/pull/420)。

### 打包

* 支持 RHEL 8 软件包。

### 运行时

* 升级至 Golang 1.12.12 [docker/engine#418](https://github.com/docker/engine/pull/418)。
* 将 RootlessKit 更新至 v0.7.0，通过挂载命名空间和 seccomp 加固 slirp4netns [docker/engine#397](https://github.com/docker/engine/pull/397)。
* 修复了从事件处理器传播 `GetContainer` 错误的问题 [docker/engine#407](https://github.com/docker/engine/pull/407)。
* 修复了推送 OCI 镜像的问题 [docker/engine#405](https://github.com/docker/engine/pull/405)。

## 19.03.4
2019-10-17

### 联网

* 还原了 libnetwork 的更改，以修复 `DOCKER-USER` iptables 链问题 [docker/engine#404](https://github.com/docker/engine/pull/404)。

### 已知问题

#### 现有问题

* 在某些具有大型集群的情况下，Docker 信息可能在 Swarm 部分包含错误 `code = ResourceExhausted desc = grpc: received message larger than max (5351376 vs. 4194304)`。这不代表用户有任何故障或错误配置，无需理会。
* 将所有服务作为新服务重新部署时，可能会发生编排器端口冲突。由于短时间内出现大量的 Swarm 管理节点请求，某些服务无法接收流量，导致部署后出现 `404` 错误。
     - **变通方法：** 通过 `docker service update --force` 重启所有任务。
* [CVE-2018-15664](https://nvd.nist.gov/vuln/detail/CVE-2018-15664) 带有目录遍历的符号链接交换攻击。在即将发布的补丁版本提供正式修复之前，请在执行文件操作前 `docker pause` 容器。[moby/moby#39252](https://github.com/moby/moby/pull/39252)
* 由于 CVE 缓解措施导致的 `docker cp` 回归。当 `docker cp` 的来源设置为 `/` 时会产生错误。

## 19.03.3
2019-10-08

### 安全

* 修复了 containerd 中的 `runc`。[CVE-2017-18367](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-18367)

### 构建器 (Builder)

* 修复了 builder-next：为第三方注册表解析摘要 [docker/engine#339](https://github.com/docker/engine/pull/339)。

* 修复了 builder-next：当守护进程带套接字激活启动时的用户命名空间构建问题 [docker/engine#373](https://github.com/docker/engine/pull/373)。

* 修复了 builder-next；会话：为每个连接释放转发的 SSH 套接字连接 [docker/engine#373](https://github.com/docker/engine/pull/373)。

* 修复了 build-next：llbsolver：多个缓存导入器时报错 [docker/engine#373](https://github.com/docker/engine/pull/373)。

### 客户端

* 增加了对 Docker Template 0.1.6 的支持。

* 防范具有过度别名的 YAML 文件 [docker/cli#2119](https://github.com/docker/cli/pull/2119)。

### 运行时

* 升级至 Golang 1.12.10 [docker/engine#387](https://github.com/docker/engine/pull/387)。

* 升级至 containerd 1.2.10 [docker/engine#385](https://github.com/docker/engine/pull/385)。

* 分发 (Distribution)：修改了拉取 v2 schema1 清单时的警告逻辑 [docker/engine#368](https://github.com/docker/engine/pull/368)。

* 修复了提供错误的平台选项时 `POST /images/create` 返回 500 状态码的问题 [docker/engine#365](https://github.com/docker/engine/pull/365)。

* 修复了提供错误的平台选项时 `POST /build` 返回 500 状态码的问题 [docker/engine#365](https://github.com/docker/engine/pull/365)。

* 修复了由于结构体成员未对齐导致的 32 位 ARMv7 崩溃问题 [docker/engine#363](https://github.com/docker/engine/pull/363)。

* 修复了链接到不存在的容器时返回 "invalid parameter" 的问题 [docker/engine#352](https://github.com/docker/engine/pull/352)。

* 修复了使用内核 >= 5.2 时 overlay2 的挂载繁忙错误 [docker/engine#332](https://github.com/docker/engine/pull/332)。

* 修复了在某些配置不当的系统 (例如失效的 NFS 共享) 中 `docker rmi` 卡住的问题 [docker/engine#335](https://github.com/docker/engine/pull/335)。

* 修复了处理 exec 进程被阻塞的 I/O 问题 [docker/engine#296](https://github.com/docker/engine/pull/296)。

* 修复了 jsonfile 日志记录器：当设置了 `max-size` 且 `max-file=1` 时，跟随日志卡住的问题 [docker/engine#378](https://github.com/docker/engine/pull/378)。

### 已知问题

#### 新增问题

* `DOCKER-USER` iptables 链缺失：[docker/for-linux#810](https://github.com/docker/for-linux/issues/810)。用户无法在此 iptables 链之上执行额外的容器网络流量过滤。如果您没有在 `DOCKER-USER` 之上自定义 iptable 链，则不受此问题影响。
     - **变通方法：** 在 Docker 守护进程启动后插入 iptables 链。例如：
       ```
       iptables -N DOCKER-USER
       iptables -I FORWARD -j DOCKER-USER
       iptables -A DOCKER-USER -j RETURN
       ```

#### 现有问题

* 在某些具有大型集群的情况下，Docker 信息可能在 Swarm 部分包含错误 `code = ResourceExhausted desc = grpc: received message larger than max (5351376 vs. 4194304)`。这不代表用户有任何故障或错误配置，无需理会。
* 将所有服务作为新服务重新部署时，可能会发生编排器端口冲突。由于短时间内出现大量的 Swarm 管理节点请求，某些服务无法接收流量，导致部署后出现 `404` 错误。
     - **变通方法：** 通过 `docker service update --force` 重启所有任务。
* [CVE-2018-15664](https://nvd.nist.gov/vuln/detail/CVE-2018-15664) 带有目录遍历的符号链接交换攻击。在即将发布的补丁版本提供正式修复之前，请在执行文件操作前 `docker pause` 容器。[moby/moby#39252](https://github.com/moby/moby/pull/39252)
* 由于 CVE 缓解措施导致的 `docker cp` 回归。当 `docker cp` 的来源设置为 `/` 时会产生错误。

## 19.03.2
2019-09-03

### 构建器 (Builder)

* 修复了 Windows 上 `COPY --from` 到不存在目录的问题 [moby/moby#39695](https://github.com/moby/moby/pull/39695)。

* 修复了 builder-next：元数据命令在历史记录中没有创建时间的问题 [moby/moby#39456](https://github.com/moby/moby/issues/39456)。

* 修复了 builder-next：层导出错误时关闭进度 [moby/moby#39782](https://github.com/moby/moby/pull/39782)。

* 将 buildkit 更新至 588c73e1e4 [moby/moby#39781](https://github.com/moby/moby/pull/39781)。

### 客户端

* 修复了在非 Windows 系统上对 Windows 绝对路径的检测 [docker/cli#1990](https://github.com/docker/cli/pull/1990)。

* 修复了 `docker login --username` 的 zsh 补全脚本。

* 修复了上下文 (context)：使 `context create` 的输出保持一致 [docker/cli#1985](https://github.com/docker/cli/pull/1874)。

* 修复了对 HTTP 代理环境变量的支持 [docker/cli#2059](https://github.com/docker/cli/pull/2059)。

### 日志记录

* 修复了读取 journald 日志的问题 [moby/moby#37819](https://github.com/moby/moby/pull/37819) [moby/moby#38859](https://github.com/moby/moby/pull/38859)。

### 联网

* 防止在附加了禁用联网容器的网络上发生崩溃 (panic) [moby/moby#39589](https://github.com/moby/moby/pull/39589)。

### 运行时

* 升级至 Golang 1.12.8。

* 修复了为容器使用 XFS 磁盘配额时可能出现的引擎崩溃 (panic) [moby/moby#39644](https://github.com/moby/moby/pull/39644)。

### Swarm

* 修复了具有多个任务的节点无法被移除的问题 [docker/swarmkit#2867](https://github.com/docker/swarmkit/pull/2867)。

### 已知问题

* 在某些具有大型集群的情况下，Docker 信息可能在 Swarm 部分包含错误 `code = ResourceExhausted desc = grpc: received message larger than max (5351376 vs. 4194304)`。这不代表用户有任何故障或错误配置，无需理会。
* 将所有服务作为新服务重新部署时，可能会发生编排器端口冲突。由于短时间内出现大量的 Swarm 管理节点请求，某些服务无法接收流量，导致部署后出现 `404` 错误。
     - **变通方法：** 通过 `docker service update --force` 重启所有任务。

* 由于 FORWARD 链中缺少 Iptables 规则，流量无法从主机流出。
  缺失的规则为：
     ```
     /sbin/iptables --wait -C FORWARD -o docker_gwbridge -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
     /sbin/iptables --wait -C FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
     ```
     - **变通方法：** 使用脚本和 cron 定义将这些规则添加回来。脚本必须包含 '-C' 命令来检查规则是否存在，以及 '-A' 命令来添加规则。按固定时间间隔 (例如每隔 x 分钟) 在 cron 上运行该脚本。
     - 受影响的版本：18.09.1, 19.03.0。
* [CVE-2018-15664](https://nvd.nist.gov/vuln/detail/CVE-2018-15664) 带有目录遍历的符号链接交换攻击。在即将发布的补丁版本提供正式修复之前，请在执行文件操作前 `docker pause` 容器。[moby/moby#39252](https://github.com/moby/moby/pull/39252)
* 由于 CVE 缓解措施导致的 `docker cp` 回归。当 `docker cp` 的来源设置为 `/` 时会产生错误。

## 19.03.1
2019-07-25

### 安全

 * 修复了 Glibc 下 chroot 内部加载基于 nsswitch 配置的问题。[CVE-2019-14271](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-14271)

### 已知问题

 * 在某些具有大型集群的情况下，Docker 信息可能在 Swarm 部分包含错误 `code = ResourceExhausted desc = grpc: received message larger than max (5351376 vs. 4194304)`。这不代表用户有任何故障或错误配置，无需理会。
 * 将所有服务作为新服务重新部署时，可能会发生编排器端口冲突。由于短时间内出现大量的 Swarm 管理节点请求，某些服务无法接收流量，导致部署后出现 `404` 错误。
    - **变通方法：** 通过 `docker service update --force` 重启所有任务。

 * 由于 FORWARD 链中缺少 Iptables 规则，流量无法从主机流出。
  缺失的规则为：
     ```
     /sbin/iptables --wait -C FORWARD -o docker_gwbridge -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
     /sbin/iptables --wait -C FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
     ```
     - **变通方法：** 使用脚本和 cron 定义将这些规则添加回来。脚本必须包含 '-C' 命令来检查规则是否存在，以及 '-A' 命令来添加规则。按固定时间间隔 (例如每隔 x 分钟) 在 cron 上运行该脚本。
     - 受影响的版本：18.09.1, 19.03.0。
 * [CVE-2018-15664](https://nvd.nist.gov/vuln/detail/CVE-2018-15664) 带有目录遍历的符号链接交换攻击。在即将发布的补丁版本提供正式修复之前，请在执行文件操作前 `docker pause` 容器。[moby/moby#39252](https://github.com/moby/moby/pull/39252)
 * 由于 CVE 缓解措施导致的 `docker cp` 回归。当 `docker cp` 的来源设置为 `/` 时会产生错误。

## 19.03.0
2019-07-22

### 构建器 (Builder)

* 修复了 `COPY --from` 以保留所有权 [moby/moby#38599](https://github.com/moby/moby/pull/38599)。
* builder-next：

    - 增加了内联缓存支持 `--cache-from` [docker/engine#215](https://github.com/docker/engine/pull/215)。
    - 允许配置 outputs [moby/moby#38898](https://github.com/moby/moby/pull/38898)。
    - 修复了 gcr 变通方法的令牌缓存问题 [docker/engine#212](https://github.com/docker/engine/pull/212)。
    - 下载错误时调用 `stopprogress` [docker/engine#215](https://github.com/docker/engine/pull/215)。
    - Buildkit 现在使用 systemd 的 `resolv.conf` [docker/engine#260](https://github.com/docker/engine/pull/260)。
    - 现在允许设置 buildkit outputs [docker/cli#1766](https://github.com/docker/cli/pull/1766)。
    - 寻找针对 Dockerfile 的 dockerignore 文件 (例如 `Dockerfile.dockerignore`) 以获取被忽略的路径 [docker/engine#215](https://github.com/docker/engine/pull/215)。
    - 自动检测是否可以针对 x86、arm 和 arm64 二进制文件执行进程 [docker/engine#215](https://github.com/docker/engine/pull/215)。
    - 将 buildkit 更新至 1f89ec1 [docker/engine#260](https://github.com/docker/engine/pull/260)。
    - 默认使用 Dockerfile 前端版本 `docker/dockerfile:1.1` [docker/engine#215](https://github.com/docker/engine/pull/215)。
    - COPY/ADD 操作不再依赖于外部镜像 [docker/engine#215](https://github.com/docker/engine/pull/215)。

### 客户端

* 为 `docker update` 增加了 `--pids-limit` 标志 [docker/cli#1765](https://github.com/docker/cli/pull/1765)。
* 为服务增加了 systctl 支持 [docker/cli#1754](https://github.com/docker/cli/pull/1754)。
* 在 Compose 文件中增加了对 `template_driver` 的支持 [docker/cli#1746](https://github.com/docker/cli/pull/1746)。
* 为 Windows 增加了 `--device` 支持 [docker/cli#1606](https://github.com/docker/cli/pull/1606)。
* 增加了对数据路径端口 (Data Path Port) 配置的支持 [docker/cli#1509](https://github.com/docker/cli/pull/1509)。
* 增加了快速上下文切换：命令 [docker/cli#1501](https://github.com/docker/cli/pull/1501)。
* 增加了对 `--mount type=bind,bind-nonrecursive,...` 的支持 [docker/cli#1430](https://github.com/docker/cli/pull/1430)。
* 增加了每个节点的最高副本数限制 [docker/cli#1612](https://github.com/docker/cli/pull/1612)。
* 增加了静默拉取镜像的选项 [docker/cli#882](https://github.com/docker/cli/pull/882)。
* 增加了独立的 `--domainname` 标志 [docker/cli#1130](https://github.com/docker/cli/pull/1130)。
* 在 `docker stack deploy` 中增加了对机密驱动程序 (secret drivers) 的支持 [docker/cli#1783](https://github.com/docker/cli/pull/1783)。
* 增加了将 Swarm `Configs` 用作服务上的 `CredentialSpecs` 的能力 [docker/cli#1781](https://github.com/docker/cli/pull/1781)。
* 增加了 `--security-opt systempaths=unconfined` 支持 [docker/cli#1808](https://github.com/docker/cli/pull/1808)。
* 增加了编写和运行 CLI 插件的基础框架 [docker/cli#1564](https://github.com/docker/cli/pull/1564) [docker/cli#1898](https://github.com/docker/cli/pull/1898)。
* 将 Docker App 升级至 v0.8.0 [docker/docker-ce-packaging#341](https://github.com/docker/docker-ce-packaging/pull/341)。
* 增加了对 Docker buildx 的支持 [docker/docker-ce-packaging#336](https://github.com/docker/docker-ce-packaging/pull/336)。
* 增加了对 Docker Assemble v0.36.0 的支持。
* 增加了对 Docker Cluster v1.0.0-rc2 的支持。
* 增加了对 Docker Template v0.1.4 的支持。
* 增加了对 Docker Registry v0.1.0-rc1 的支持。
* 升级 `google.golang.org/grpc` 至 v1.20.1 [docker/cli#1884](https://github.com/docker/cli/pull/1884)。
* 更改了 CLI，以便将驱动程序特定的选项传递给 `docker run` [docker/cli#1767](https://github.com/docker/cli/pull/1767)。
* 升级至 Golang 1.12.5 [docker/cli#1875](https://github.com/docker/cli/pull/1875)。
* `docker system info` 的输出现在会将与客户端和守护进程相关的信息分开 [docker/cli#1638](https://github.com/docker/cli/pull/1638)。
* (实验性) 当针对 Kubernetes 时，在 Compose 文件的服务配置中增加了对 `x-pull-secret: some-pull-secret` 的支持 [docker/cli#1617](https://github.com/docker/cli/pull/1617)。
* (实验性) 当针对 Kubernetes 时，在 Compose 文件的服务配置中增加了对 `x-pull-policy: <Never|Always|IfNotPresent>` 的支持 [docker/cli#1617](https://github.com/docker/cli/pull/1617)。
* cp, save, export：现在会防止覆盖非正常文件 [docker/cli#1515](https://github.com/docker/cli/pull/1515)。
* 现在允许在 stack 文件中使用 npipe 卷类型 [docker/cli#1195](https://github.com/docker/cli/pull/1195)。
* 修复了 tty 初始大小错误 [docker/cli#1529](https://github.com/docker/cli/pull/1529)。
* 修复了标签从环境变量复制值的问题 [docker/cli#1671](https://github.com/docker/cli/pull/1671)。

### API

* 将 API 版本更新至 v1.40 [moby/moby#38089](https://github.com/moby/moby/pull/38089)。
* 为 `/info` 端点增加了警告，并将检测逻辑移动到了守护进程 [moby/moby#37502](https://github.com/moby/moby/pull/37502)。
* 为 `/_ping` 端点增加了 HEAD 支持 [moby/moby#38570](https://github.com/moby/moby/pull/38570)。
* 增加了 `Cache-Control` 标头以禁用对 `/_ping` 端点的缓存 [moby/moby#38569](https://github.com/moby/moby/pull/38569)。
* 向 `/version` 增加了 `containerd`、`runc` 和 `docker-init` 的版本信息 [moby/moby#37974](https://github.com/moby/moby/pull/37974)。
* 增加了未记录的 `/grpc` 端点并注册了 BuildKit 的控制器 [moby/moby#38990](https://github.com/moby/moby/pull/38990)。

### 实验性功能 (Experimental)
* 启用了带有 TTY 容器的检查点/恢复 (checkpoint/restore) 功能 [moby/moby#38405](https://github.com/moby/moby/pull/38405)。
* LCOW：增加了对内存和 CPU 限制的支持 [moby/moby#37296](https://github.com/moby/moby/pull/37296)。
* Windows：增加了 ContainerD 运行时 [moby/moby#38541](https://github.com/moby/moby/pull/38541)。
* Windows：LCOW 现在需要 Windows RS5+ [moby/moby#39108](https://github.com/moby/moby/pull/39108)。

### 安全

* 挂载：增加了 `BindOptions.NonRecursive` (API v1.40) [moby/moby#38003](https://github.com/moby/moby/pull/38003)。
* seccomp：将 `io_pgetevents()` 列入白名单 [moby/moby#38895](https://github.com/moby/moby/pull/38895)。
* seccomp：允许在 4.8+ 内核上使用 `ptrace(2)` [moby/moby#38137](https://github.com/moby/moby/pull/38137)。

### 运行时

* 允许以非 root 用户身份运行 `dockerd` (无根模式) [moby/moby#380050](https://github.com/moby/moby/pull/380050)。
* 无根模式：为 `lxc-user-nic` SUID 二进制文件提供了可选支持 [docker/engine#208](https://github.com/docker/engine/pull/208)。
* 向 `HostConfig` 增加了 `DeviceRequests` 以支持 NVIDIA GPU [moby/moby#38828](https://github.com/moby/moby/pull/38828)。
* 为 Windows 增加了 `--device` 支持 [moby/moby#37638](https://github.com/moby/moby/pull/37638)。
* 为 Linux 增加了 `memory.kernelTCP` 支持 [moby/moby#37043](https://github.com/moby/moby/pull/37043)。
* Windows 凭据规范 (credential specs) 现在可以直接传递给引擎 [moby/moby#38777](https://github.com/moby/moby/pull/38777)。
* 在 `docker update` 中增加了 `pids-limit` 支持 [moby/moby#32519](https://github.com/moby/moby/pull/32519)。
* 增加了对精确能力列表的支持 [moby/moby#38380](https://github.com/moby/moby/pull/38380)。
* 守护进程：现在默认使用 'private' ipc 模式 [moby/moby#35621](https://github.com/moby/moby/pull/35621)。
* 守护进程：为启动任务切换到了信号量门控的 WaitGroup [moby/moby#38301](https://github.com/moby/moby/pull/38301)。
* 现在使用 `idtools.LookupGroup` 而不是解析 `/etc/group` 文件来获取 `docker.sock` 的所有权，以修复 `api.go doesn't respect nsswitch.conf` 问题 [moby/moby#38126](https://github.com/moby/moby/pull/38126)。
* CLI：修复了使用多重引用过滤器时的镜像过滤器问题 [moby/moby#38171](https://github.com/moby/moby/pull/38171)。
* 升级至 Golang 1.12.5 [docker/engine#209](https://github.com/docker/engine/pull/209)。
* 升级 `containerd` 至 1.2.6 [moby/moby#39016](https://github.com/moby/moby/pull/39016)。
* 升级 `runc` 至 1.0.0-rc8，升级 `opencontainers/selinux` 至 v1.2.2 [docker/engine#210](https://github.com/docker/engine/pull/210)。
* 升级 `google.golang.org/grpc` 至 v1.20.1 [docker/engine#215](https://github.com/docker/engine/pull/215)。
* 针对大规模并发的容器创建/移除，优化了 aufs 和层存储的性能 [moby/moby#39135](https://github.com/moby/moby/pull/39135) [moby/moby#39209](https://github.com/moby/moby/pull/39209)。
* 根路径现在被传递给 chroot 用于 chroot Tar/Untar (CVE-2018-15664) [moby/moby#39292](https://github.com/moby/moby/pull/39292)。
* 修复了带有 `/dev` 绑定挂载的 `docker --init` 问题 [moby/moby#37665](https://github.com/moby/moby/pull/37665)。
* 当设备号大于 255 且使用 `--device-read-bps` 选项时，现在可以获取正确的设备号 [moby/moby#39212](https://github.com/moby/moby/pull/39212)。
* 修复了当路径确实存在时却提示 `Path does not exist` 的错误 [moby/moby#39251](https://github.com/moby/moby/pull/39251)。

### 联网

* 将 IPVLAN 驱动程序移出实验性阶段 [moby/moby#38983](https://github.com/moby/moby/pull/38983)。
* 增加了对 'dangling' 过滤器的支持 [moby/moby#31551](https://github.com/moby/moby/pull/31551) [docker/libnetwork#2230](https://github.com/docker/libnetwork/pull/2230)。
* 当使用 `--network-rm` 更新服务时，负载均衡沙箱现在会被删除 [docker/engine#213](https://github.com/docker/engine/pull/213)。
* Windows：现在强制将 `PortBindings` 中指定的 nil IP 设为 IPv4zero (0.0.0.0) [docker/libnetwork#2376](https://github.com/docker/libnetwork/pull/2376)。

### Swarm

* 增加了对每个节点最高副本数限制的支持 [moby/moby#37940](https://github.com/moby/moby/pull/37940)。
* 增加了对来自 Swarmkit 配置的 GMSA CredentialSpecs 的支持 [moby/moby#38632](https://github.com/moby/moby/pull/38632)。
* 增加了对服务中 sysctl 选项的支持 [moby/moby#37701](https://github.com/moby/moby/pull/37701)。
* 增加了对根据节点标签进行过滤的支持 [moby/moby#37650](https://github.com/moby/moby/pull/37650)。
* Windows：增加了在 `docker service create` 和 stack yml 中对命名管道挂载的支持 [moby/moby#37400](https://github.com/moby/moby/pull/37400)。
* 现在支持 VXLAN UDP 端口配置 [moby/moby#38102](https://github.com/moby/moby/pull/38102)。
* 现在在 Enforcer 中使用服务放置约束 [docker/swarmkit#2857](https://github.com/docker/swarmkit/pull/2857)。
* 增加了节点和机密的 gRPC 消息接收最大大小 [docker/engine#256](https://github.com/docker/engine/pull/256)。

### 日志记录

* 在 Windows 上启用了 `gcplogs` 驱动程序 [moby/moby#37717](https://github.com/moby/moby/pull/37717)。
* 为 RFC5424 syslog 格式增加了零填充 (zero padding) [moby/moby#38335](https://github.com/moby/moby/pull/38335)。
* 向 `journald` 日志事件增加了 `IMAGE_NAME` 属性 [moby/moby#38032](https://github.com/moby/moby/pull/38032)。

### 弃用

* 弃用镜像清单 v2 schema1，建议使用 v2 schema2。未来的 Docker 版本将彻底移除对 v2 schema1 的支持 [moby/moby#39365](https://github.com/moby/moby/pull/39365)。
* 移除了 v1.10 迁移工具 [moby/moby#38265](https://github.com/moby/moby/pull/38265)。
* 自动选择时现在会跳过已弃用的存储驱动程序 [moby/moby#38019](https://github.com/moby/moby/pull/38019)。
* 弃用了 `aufs` 存储驱动程序并增加了警告 [moby/moby#38090](https://github.com/moby/moby/pull/38090)。
* 停止支持 17.09。

有关已弃用标志和 API 的更多信息，请参考 [弃用信息](/engine/deprecated/) 以了解目标移除日期。

### 已知问题

* 在某些具有大型集群的情况下，Docker 信息可能在 Swarm 部分包含错误 `code = ResourceExhausted desc = grpc: received message larger than max (5351376 vs. 4194304)`。这不代表用户有任何故障或错误配置，无需理会。
* 将所有服务作为新服务重新部署时，可能会发生编排器端口冲突。由于短时间内出现大量的 Swarm 管理节点请求，某些服务无法接收流量，导致部署后出现 `404` 错误。
   - **变通方法：** 通过 `docker service update --force` 重启所有任务。

* 由于 FORWARD 链中缺少 Iptables 规则，流量无法从主机流出。
  缺失的规则为：
    ```
    /sbin/iptables --wait -C FORWARD -o docker_gwbridge -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
    /sbin/iptables --wait -C FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
    ```
    - **变通方法：** 使用脚本和 cron 定义将这些规则添加回来。脚本必须包含 '-C' 命令来检查规则是否存在，以及 '-A' 命令来添加规则。按固定时间间隔 (例如每隔 x 分钟) 在 cron 上运行该脚本。
    - 受影响的版本：18.09.1, 19.03.0。
* [CVE-2018-15664](https://nvd.nist.gov/vuln/detail/CVE-2018-15664) 带有目录遍历的符号链接交换攻击。在即将发布的补丁版本提供正式修复之前，请在执行文件操作前 `docker pause` 容器。[moby/moby#39252](https://github.com/moby/moby/pull/39252)
* 由于 CVE 缓解措施导致的 `docker cp` 回归。当 `docker cp` 的来源设置为 `/` 时会产生错误。
